{
  "hash": "0d39a48e2952683973c28c30389beac0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ndate: \"2026-01-16 10:49:50.205481\"\ntitle: \"LAB: Elections and Principal Component Analysis\"\n\n\nexecute:\n  echo: true\n  eval: false\n  collapse: false\n\nformat:\n  html:\n    output-file: lab-pca-votes.html\n  pdf:\n    output-file: lab-pca-votes.pdf\n\n\nengine: knitr\ndraft: true\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# We will use the following packages. \n# If needed, install them : pak::pkg_install(). \nstopifnot(\n  require(\"corrr\"),\n  require(\"magrittr\"),\n  require(\"lobstr\"),\n  require(\"ggforce\"),\n  require(\"gt\"),\n  require(\"glue\"),\n  require(\"skimr\"),\n  require(\"patchwork\"), \n  require(\"tidyverse\"),\n  require(\"ggfortify\"),\n  require(\"autoplotly\"),\n  require(fs)\n)\n```\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nold_theme <- theme_set(theme_minimal())\n\noptions(ggplot2.discrete.colour=\"viridis\")\noptions(ggplot2.discrete.fill=\"viridis\")\noptions(ggplot2.continuous.fill=\"viridis\")\noptions(ggplot2.continuous.colour=\"viridis\")\n```\n:::\n\n\n\n\n::: {layout=\"[80,20]\"}\n\n::: {#first-column}\n\n|                            |\n|:---------------------------|\n| {{< var curriculum >}}     |\n| {{< var university >}}     |\n| Année {{< var year >}}     |\n| {{< var homepage >}}       |\n| {{< var moodle >}}         |\n\n\n::: \n\n::: {#second-column}\n![](/images/UniversiteParis_monogramme_couleur_RVB.png){align=\"right\" style=\"size:50px;\" width=75}\n:::\n\n:::\n\n\n\n\n::: {.cell}\n\n:::\n\n\n\n## Paris Open Data\n\n### Scrutins\n\n\n::: {.cell}\n\n```{.r .cell-code}\nscrutins <-  bind_rows(\n  tibble(title='European P', rounds=1, year=seq(2004, 2024, 5)),\n  tibble(title='Parliament', rounds=2, year=c(seq(2002, 2022, 5),2024)),\n  tibble(title='President', rounds=2, year=seq(2002, 2022, 5)),\n  tibble(title='Local', rounds=2, year=c(2001, seq(2008, 2020, 6))),\n  tibble(title='Régionales', rounds=2, year=c(2004, 2010, 2015, 2021))\n  )\n\nscrutins |> slice_sample(n=5) |> arrange(year) |> gt::gt()\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkeys <- c(\n  \"https://opendata.paris.fr/explore/dataset/elections-legislatives-2024-2emetour/information/\"\n)\n\nfurl\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfurl <- \"https://data.opendatasoft.com/api/explore/v2.1/catalog/datasets/elections-france-presidentielles-2022-1er-tour-par-bureau-de-vote@public/exports/parquet?lang=en&refine=dep_name%3A%22Paris%22&timezone=Europe%2FParis\"\n\ntb <- arrow::read_parquet('/home/boucheron/Downloads/elections-france-presidentielles-2022-1er-tour-par-bureau-de-vote@public (1).parquet')\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfurl <- \"https://data.opendatasoft.com/api/explore/v2.1/catalog/datasets/elections-france-presidentielles-2022-2eme-tour-par-bureau-de-vote@public/exports/parquet?lang=en&refine=dep_name%3A%22Paris%22&timezone=Europe%2FParis\"\n\nr <- httr::GET(furl)\n\nr$status_code\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <- \"https://data.opendatasoft.com/explore/dataset/elections-france-presidentielles-2022-1er-tour-par-bureau-de-vote@public/export/\"\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\neuro_urls <- \nc(\n\"https://data.smartidf.services/api/explore/v2.1/catalog/datasets/elections-europeennes-2019/exports/parquet?lang=en&timezone=Europe%2FBerlin\",\n\"https://data.smartidf.services/api/explore/v2.1/catalog/datasets/elections-europeennes-2014/exports/parquet?lang=en&timezone=Europe%2FBerlin\",\n\"https://data.smartidf.services/api/explore/v2.1/catalog/datasets/elections-europeennes-2024/exports/parquet?lang=en&timezone=Europe%2FBerlin\",\n\"https://data.smartidf.services/api/explore/v2.1/catalog/datasets/elections-europeennes-2009/exports/parquet?lang=en&timezone=Europe%2FBerlin\",\n\"https://data.smartidf.services/api/explore/v2.1/catalog/datasets/elections-europeennes-2004/exports/parquet?lang=en&timezone=Europe%2FBerlin\"\n)\n\nfor (u in euro_urls) {\n\n  r <- httr::GET(u)\n  if (200==as.integer(r$status_code)) print(u)\n\n}\n```\n:::\n\n### Bureaux de vote\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndwnlds <- fs::fs_path('~') / 'Downloads'\ndwnlds_fls <- fs::dir_ls(dwnlds)\nfpth <- dwnlds_fls[stringr::str_detect( dwnlds_fls, 'secteurs')]\n\ntb_secteurs <- arrow::read_parquet(fpth)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkeys <- c(\n  \"zones-de-rattachement-des-bureaux-de-vote-en-2012\",\n  \"zones-de-rattachement-des-bureaux-de-vote-en-2014\",\n  \"secteurs-des-bureaux-de-vote-en-2017\",\n  \"secteurs-des-bureaux-de-vote-en-2020\",\n  \"secteurs-des-bureaux-de-vote-en-2021\",\n  \"secteurs-des-bureaux-de-vote-leg-2022\",\n  \"secteurs-des-bureaux-de-vote-2024\"\n)\n\nfurl <- \"https://opendata.paris.fr/api/explore/v2.1/catalog/datasets/{x}/exports/parquet?lang=fr&timezone=Europe%2FBerlin\"\n\nfor (x in keys) {\n\n  r <- httr::GET(glue(furl))\n  if (200!=as.integer(r$status_code)) print(glue(furl))\n\n}\n```\n:::\n\n\nLocalisation des bureaux de votes\n\n\n::: {.cell}\n\n```{.r .cell-code}\nkeys_loc_bureaux <- c(\n  \"bureaux-de-vote-en-2021\",\n  \"bureaux-de-votes\",\n  \"bureaux-de-vote-2024\",\n  \"bureaux-de-vote-2025\"\n)\n\nfurl <- \"https://opendata.paris.fr/api/explore/v2.1/catalog/datasets/{x}/exports/parquet?lang=fr&timezone=Europe%2FBerlin\"\n\nfor (x in keys_loc_bureaux) {\n  print(glue(furl))\n  r <- httr::GET(glue(furl))\n  print(as.integer(r$status_code))\n}\n```\n:::\n\n\n\n\n\n::: {.cell}\n\n:::\n\n\n## Elections\n\n\n## PCA \n\n\n## Clustering\n\n\n# References \n\n\n\n\n[](https://github.com/datagouv/bureau-vote)",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}