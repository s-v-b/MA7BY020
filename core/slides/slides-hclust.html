<!DOCTYPE html>
<html lang="en-US"><head>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-a6e161b2431e1f94a14e0f5d32135a3c.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/quarto-contrib/reveal-header-1.0.0/add_header.js" defer="true"></script>
<link href="../../site_libs/quarto-contrib/reveal-header-1.0.0/add_header.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/grid-htext-1.0.0/grid_htext.css" rel="stylesheet">
<script src="../../site_libs/quarto-contrib/pseudocode-2.4.1/pseudocode.min.js"></script>
<link href="../../site_libs/quarto-contrib/pseudocode-2.4.1/pseudocode.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">
<meta name="author" content="Équipe EAD">
<meta name="dcterms.date" content="2025-04-02">
<title>MA7BY020 - Spring 2026 – Hierarchical Clustering</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
<link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
<link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
<style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #24292e;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #24292e; } /* Normal */
    code span.al { color: #ff5555; font-weight: bold; } /* Alert */
    code span.an { color: #6a737d; } /* Annotation */
    code span.at { color: #d73a49; } /* Attribute */
    code span.bn { color: #005cc5; } /* BaseN */
    code span.bu { color: #d73a49; } /* BuiltIn */
    code span.cf { color: #d73a49; } /* ControlFlow */
    code span.ch { color: #032f62; } /* Char */
    code span.cn { color: #005cc5; } /* Constant */
    code span.co { color: #6a737d; } /* Comment */
    code span.cv { color: #6a737d; } /* CommentVar */
    code span.do { color: #6a737d; } /* Documentation */
    code span.dt { color: #d73a49; } /* DataType */
    code span.dv { color: #005cc5; } /* DecVal */
    code span.er { color: #ff5555; text-decoration: underline; } /* Error */
    code span.ex { color: #d73a49; font-weight: bold; } /* Extension */
    code span.fl { color: #005cc5; } /* Float */
    code span.fu { color: #6f42c1; } /* Function */
    code span.im { color: #032f62; } /* Import */
    code span.in { color: #6a737d; } /* Information */
    code span.kw { color: #d73a49; } /* Keyword */
    code span.op { color: #24292e; } /* Operator */
    code span.ot { color: #6f42c1; } /* Other */
    code span.pp { color: #d73a49; } /* Preprocessor */
    code span.re { color: #6a737d; } /* RegionMarker */
    code span.sc { color: #005cc5; } /* SpecialChar */
    code span.ss { color: #032f62; } /* SpecialString */
    code span.st { color: #032f62; } /* String */
    code span.va { color: #e36209; } /* Variable */
    code span.vs { color: #032f62; } /* VerbatimString */
    code span.wa { color: #ff5555; } /* Warning */
  </style>
<link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-970bcd7a187d3050da7c0c3921783a49.css">
<link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
<link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
<link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
<link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
<style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
<script>
  MathJax = {
    loader: {
      load: ['[tex]/boldsymbol']
    },
    tex: {
      tags: "all",
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['$$','$$'], ['\\[','\\]']],
      processEscapes: true,
      processEnvironments: true,
      packages: {
        '[+]': ['boldsymbol']
      }
    }
  };
  </script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
<meta property="og:title" content="Hierarchical Clustering – MA7BY020 - Spring 2026">
<meta property="og:description" content="Analyse de Données Master MIDS">
<meta property="og:site_name" content="MA7BY020 - Spring 2026">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-color="#1c191c" class="quarto-title-block center"><h1 class="title">Hierarchical Clustering</h1>
  <p class="subtitle"><a href="https://s-v-b.github.io/MA7BY020/">Analyse de Données Master MIDS</a></p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Équipe EAD 
</div>
        <p class="quarto-title-affiliation">
            <a href="https://u-paris.fr">LPSM Université Paris-Cité</a>
          </p>
    </div>
</div>

  <p class="date">2025-04-02</p>
</section><section id="TOC"><nav role="doc-toc"><h2 id="toc-title">Roadmap</h2>
<ul>
<li><a href="#/hierarchical-clustering" id="/toc-hierarchical-clustering">Hierarchical clustering</a></li>
<li><a href="#/inside-hclust" id="/toc-inside-hclust">Inside <code>hclust</code></a></li>
<li><a href="#/comparing-dendrograms" id="/toc-comparing-dendrograms">Comparing dendrograms</a></li>
<li><a href="#/the-end" id="/toc-the-end">The End</a></li>
</ul></nav></section><section><section id="hierarchical-clustering" class="title-slide slide level1 center" data-background-color="#1c191c"><h1>Hierarchical clustering</h1>
<aside class="notes"><ul>
<li>Dendrogram : what is it?</li>
<li>From dendrogram to clusterings: cutting a dendrogram</li>
<li>Grow a dendrogram</li>
<li>Displaying a dendrogram</li>
<li>Validation and assesment</li>
</ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside></section><section id="section" class="slide level2 center"><h2></h2>
<blockquote>
<p>Hierarchical clustering […] is a method of cluster analysis which seeks to build a hierarchy of clusters</p>
<p>from Wikipedia</p>
</blockquote>
<div class="fragment">
<p>Recall that a clustering is a <em>partition</em> of some dataset</p>
<p>A partition <span class="math inline">\(D\)</span> of <span class="math inline">\(\mathcal{X}\)</span> is a <em>refinement</em> of another partition <span class="math inline">\(D'\)</span> if every class in <span class="math inline">\(D\)</span> is a subset of a class in <span class="math inline">\(D'\)</span>. Partitions <span class="math inline">\(D\)</span> and <span class="math inline">\(D'\)</span> are said to be <em>nested</em></p>
</div>
<div class="fragment">
<p>A hierarchical clustering of <span class="math inline">\(\mathcal{X}\)</span> is a sequence of <span class="math inline">\(|\mathcal{X}|\)</span> nested partitions of <span class="math inline">\(\mathcal{X}\)</span>, starting from the trivial partition into <span class="math inline">\(|\mathcal{X}|\)</span> singletons and ending into the trivial partition in <span class="math inline">\(1\)</span> subset ( <span class="math inline">\(\mathcal{X}\)</span> itself)</p>
<p>A hierarchical clustering consists of <span class="math inline">\(|\mathcal{X}|\)</span> nested flat clusterings</p>
<p>We will explore <em>agglomerative</em> or <em>bottom-up</em> methods to build hierarchical clusterings</p>
</div>
</section><section id="hierchical-clustering-and-dendrogram" class="slide level2 smaller center"><h2>Hierchical clustering and dendrogram</h2>
<div class="{columns}">
<div class="column" style="width:35%;">
<p>The result of hierarchical clustering is a <em>tree</em> where <em>leafs</em> are labelled by sample points and internal nodes correspond to merging operations</p>
<p>The tree conveys more information: if the tree is properly decorated, it is possible to reconstruct the different merging steps and to know which rule was applied when some merging operation was performed</p>
<p>The tree is called a <em>dendrogram</em></p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure><p><img data-src="slides-hclust_files/figure-revealjs/unnamed-chunk-3-1.png" width="768"></p>
</figure>
</div>
</div>
</div>
<pre><code>Violent Crime Rates by US State

Description

This data set contains statistics, in arrests per 100,000 residents for assault, murder, and rape in each of the 50 US states in 1973. Also given is the percent of the population living in urban areas.</code></pre>
</div></div>
</section><section id="section-1" class="slide level2 center"><h2><i class="fa-solid fa-hand-point-right" aria-label="hand-point-right"></i></h2>
<p>Dendrogram and trees show up in several areas.</p>
<p>Classification and Regression trees play an important role in Machine Learning.</p>
<p><code>ggdendro</code> and <code>dendextend</code> may also be used to manipulate regression trees</p>
</section><section id="section-2" class="slide level2 center"><h2><i class="fa-solid fa-route" aria-label="route"></i></h2>
<ul>
<li><p>Cutting a dendrogram: getting a flat clustering</p></li>
<li><p>Building a dendrogram: inside <code>hclust</code></p></li>
<li><p>Displaying, reporting dendrograms</p></li>
</ul></section><section id="cutting-a-dendrogram-iris-illustration" class="slide level2 smaller center"><h2>Cutting a dendrogram: Iris illustration</h2>
<blockquote>
<p>The famous (Fisher’s or Anderson’s) iris data set gives the measurements in centimeters of the variables sepal length and width and petal length and width, respectively, for 50 flowers from each of 3 species of iris. The species are Iris setosa, versicolor, and virginica.</p>
</blockquote>
<blockquote>
<p>The Iris flower data set is fun for learning supervised classification algorithms, and is known as a difficult case for unsupervised learning.</p>
</blockquote>
<blockquote>
<p>The Setosa species are distinctly different from Versicolor and Virginica (they have lower petal length and width). But Versicolor and Virginica cannot easily be separated based on measurements of their sepal and petal width/length.</p>
</blockquote>
</section><section id="section-3" class="slide level2 center"><h2></h2>
<div class="cell">

<div class="cell-output cell-output-stdout">
<pre><code>&lt;ScaleContinuousPosition&gt;
 Range:  
 Limits:    0 --    1</code></pre>
</div>
</div>
<img data-src="slides-hclust_files/figure-revealjs/iris-hclust-dendro-1.png" width="960" class="r-stretch"></section><section id="section-4" class="slide level2 center"><h2></h2>
<ul>
<li>
<code>as.matrix(dist(iris[,1:4]))</code> returns the matrix of pairwise distances</li>
<li>Default distance is Euclidean distance</li>
<li>What about using <code><a href="https://generics.r-lib.org/reference/augment.html">broom::augment</a></code>?</li>
<li>There is no <code>augment.hclust</code> method: <code>No augment method for objects of class hclust</code>
</li>
</ul></section><section id="hclust-pipeline" class="slide level2 smaller center"><h2>
<code>hclust</code> pipeline</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a>dendro_iris <span class="ot">&lt;-</span> iris <span class="sc">|&gt;</span> </span>
<span id="cb3-2"><a></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">|&gt;</span>  </span>
<span id="cb3-3"><a></a>  <span class="fu">dist</span>() <span class="sc">|&gt;</span> </span>
<span id="cb3-4"><a></a>  <span class="fu">hclust</span>() <span class="sc">|&gt;</span> </span>
<span id="cb3-5"><a></a>  <span class="fu">dendro_data</span>() </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a>mydendro <span class="ot">&lt;-</span> . <span class="sc">%$%</span> {  <span class="co">#&lt;&lt;</span></span>
<span id="cb4-2"><a></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb4-3"><a></a>    <span class="fu">geom_segment</span>(</span>
<span id="cb4-4"><a></a>      <span class="at">data =</span> segments,   <span class="co">#&lt;&lt;</span></span>
<span id="cb4-5"><a></a>      <span class="fu">aes</span>(</span>
<span id="cb4-6"><a></a>        <span class="at">x =</span> x, <span class="at">y =</span> y, </span>
<span id="cb4-7"><a></a>        <span class="at">xend =</span> xend, </span>
<span id="cb4-8"><a></a>        <span class="at">yend =</span> yend)</span>
<span id="cb4-9"><a></a>  ) <span class="sc">+</span></span>
<span id="cb4-10"><a></a>  <span class="fu">geom_text</span>(</span>
<span id="cb4-11"><a></a>    <span class="at">data =</span> labels, <span class="co">#&lt;&lt;</span></span>
<span id="cb4-12"><a></a>    <span class="fu">aes</span>(</span>
<span id="cb4-13"><a></a>      <span class="at">x =</span> x, <span class="at">y =</span> y, </span>
<span id="cb4-14"><a></a>      <span class="at">label =</span> label, <span class="at">hjust =</span> <span class="dv">0</span>),</span>
<span id="cb4-15"><a></a>    <span class="at">size =</span> <span class="dv">2</span></span>
<span id="cb4-16"><a></a>  ) <span class="sc">+</span></span>
<span id="cb4-17"><a></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb4-18"><a></a>  <span class="fu">scale_y_reverse</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb4-19"><a></a>  <span class="fu">theme_dendro</span>()  </span>
<span id="cb4-20"><a></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="section-5" class="slide level2 center"><h2></h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a><span class="fu">mydendro</span>(dendro_iris)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>

</div>
<img data-src="slides-hclust_files/figure-revealjs/unnamed-chunk-4-1.png" width="960" class="r-stretch"></section><section id="section-6" class="slide level2 smaller center"><h2></h2>
</section><section id="section-7" class="slide level2 center"><h2></h2>

<img data-src="slides-hclust_files/figure-revealjs/unnamed-chunk-6-1.png" width="960" class="r-stretch"></section><section id="inside-ggdendro" class="slide level2 center"><h2>Inside ggdendro</h2>

<img data-src="slides-hclust_files/figure-revealjs/unnamed-chunk-7-1.png" width="960" class="r-stretch"></section><section id="section-8" class="slide level2 center"><h2></h2>
<p>What is an object of class <code>dendro</code> made of?</p>
<p>It a list of four elements:</p>
<ul>
<li><code>segments</code></li>
<li><code>labels</code></li>
<li><code>leaf_labels</code></li>
<li><code>class</code></li>
</ul>
<p>Element <code>segments</code> is a data frame with four columns. Each row represent a segment that is part of a graphical representation of the hierarchy. There are horizontal and vertical segments</p>
<p>Element <code>labels</code> is used to label the tree leafs.</p>
</section><section id="section-9" class="slide level2 center"><h2></h2>

<img data-src="slides-hclust_files/figure-revealjs/unnamed-chunk-8-1.png" width="960" class="r-stretch"></section><section id="cutting-a-dendrogram-iris-illustration-continued" class="slide level2 center"><h2>Cutting a dendrogram: <i class="fa-solid fa-syringe" aria-label="syringe"></i> Iris illustration (continued)</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a>p <span class="ot">&lt;-</span> iris <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-3"><a></a>  <span class="fu">aes</span>(<span class="at">x=</span>Petal.Length, <span class="at">y=</span>Petal.Width)</span>
<span id="cb6-4"><a></a></span>
<span id="cb6-5"><a></a>p <span class="sc">+</span></span>
<span id="cb6-6"><a></a>  <span class="fu">geom_point</span>(</span>
<span id="cb6-7"><a></a>    <span class="fu">aes</span>(</span>
<span id="cb6-8"><a></a>      <span class="at">shape=</span>Species, </span>
<span id="cb6-9"><a></a>      <span class="at">colour=</span>Species)</span>
<span id="cb6-10"><a></a>  ) <span class="sc">+</span></span>
<span id="cb6-11"><a></a><span class="co"># labs(shape= "Species") +</span></span>
<span id="cb6-12"><a></a>  <span class="fu">ggtitle</span>(</span>
<span id="cb6-13"><a></a>    <span class="at">label=</span> <span class="st">"Iris data"</span>,</span>
<span id="cb6-14"><a></a>    <span class="at">subtitle =</span> <span class="st">"Species in Petal plane"</span></span>
<span id="cb6-15"><a></a>  )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>

</div>
<img data-src="slides-hclust_files/figure-revealjs/iris-hclust-1-1.png" width="960" class="r-stretch"></section><section id="section-10" class="slide level2 center"><h2></h2>
<p>Does the flat clustering obtained by cutting the dendrogram at some height reflect the partition into species?</p>
</section><section id="cutting-a-dendrogram-iris-illustration-continued-1" class="slide level2 center"><h2>Cutting a dendrogram: Iris illustration (continued)</h2>

<img data-src="slides-hclust_files/figure-revealjs/iris-hclust-2-1.png" width="960" class="r-stretch"></section><section id="cutting-a-dendrogram-iris-illustration-continued-2" class="slide level2 center"><h2>Cutting a dendrogram: Iris illustration (continued)</h2>

<img data-src="slides-hclust_files/figure-revealjs/iris-hclust-3-1.png" width="960" class="r-stretch"></section><section id="cutting-a-dendrogram-iris-illustration-continued-3" class="slide level2 center"><h2>Cutting a dendrogram: Iris illustration (continued)</h2>

<img data-src="slides-hclust_files/figure-revealjs/iris-hclust-4-1.png" width="960" class="r-stretch"></section><section id="cutting-a-dendrogram-iris-illustration-continued-4" class="slide level2 center"><h2>Cutting a dendrogram: Iris illustration (continued)</h2>

<img data-src="slides-hclust_files/figure-revealjs/iris-hclust-5-1.png" width="960" class="r-stretch"></section><section id="section-11" class="slide level2 center"><h2></h2>
</section><section id="cutting-a-dendrogram-better-iris-illustration-continued" class="slide level2 center"><h2>Cutting a dendrogram: better Iris illustration (continued)</h2>
<p>The <a href="https://talgalili.github.io/dendextend/articles/dendextend.html"><code>dendextend</code></a> package offers a set of functions for extending <em>dendrogram</em> objects in <svg aria-hidden="true" role="img" viewbox="0 0 581 512" style="height:1em;width:1.13em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"></path></svg>, letting you</p>
<ul>
<li>visualize and</li>
<li>compare trees of hierarchical clusterings,</li>
</ul>
<p>Features:</p>
<ul>
<li>Adjust a tree’s graphical parameters - the color, size, type, etc, of its branches, nodes and labels</li>
<li>Visually and statistically compare different dendrograms to one another</li>
</ul></section><section id="section-12" class="slide level2 center"><h2></h2>

<img data-src="slides-hclust_files/figure-revealjs/hang-iris-1.png" width="960" class="r-stretch"><aside class="notes"><ul>
<li><p><a href="https://talgalili.github.io/dendextend/articles/dendextend.html">dendextend</a></p></li>
<li><p><a href="https://www.r-graph-gallery.com/340-custom-your-dendrogram-with-dendextend.html">A dendro gallery</a></p></li>
<li><p>class of <code>dend</code></p></li>
</ul><style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside></section></section><section><section id="inside-hclust" class="title-slide slide level1 center" data-background-color="#1c191c"><h1>Inside <code>hclust</code>
</h1>

</section><section id="about-class-hclust" class="slide level2 center"><h2>About class <code>hclust</code>
</h2>
<p>Results from function <code><a href="https://rdrr.io/r/stats/hclust.html">hclust()</a></code> are objects of class <code>hclust</code> :</p>
<p><code>iris_hclust</code> is an object of class hclust</p>
<p>Function <code><a href="https://rdrr.io/r/stats/cutree.html">cutree()</a></code> returns a flat clustering of the dataset</p>
<aside class="notes"><p>What does <code>height</code> stand for?</p>
<p>What does <code>merge</code> stand for?</p>
<p>What does <code>order</code> stand for?</p>
<p>How different are the different <code>method</code>?</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside></section><section id="hierarchical-clustering-of-usarrests" class="slide level2 center"><h2>Hierarchical clustering of <code>USArrests</code>
</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 50
Columns: 4
$ Murder   &lt;dbl&gt; 13.2, 10.0, 8.1, 8.8, 9.0, 7.9, 3.3, 5.9, 15.4, 17.4, 5.3, 2.…
$ Assault  &lt;int&gt; 236, 263, 294, 190, 276, 204, 110, 238, 335, 211, 46, 120, 24…
$ UrbanPop &lt;int&gt; 58, 48, 80, 50, 91, 78, 77, 72, 80, 60, 83, 54, 83, 65, 57, 6…
$ Rape     &lt;dbl&gt; 21.2, 44.5, 31.0, 19.5, 40.6, 38.7, 11.1, 15.8, 31.9, 25.8, 2…</code></pre>
</div>
</div>

<img data-src="slides-hclust_files/figure-revealjs/dendro-USArrests-1.png" width="960" class="r-stretch"></section><section id="about-dendrograms-output-dendro_data" class="slide level2 center"><h2>About dendrograms (output <code>dendro_data()</code>)</h2>
<p>An object of class <code>dendro</code> is a list of 4 objects:</p>
<ul>
<li><code>segments</code></li>
<li><code>labels</code></li>
<li><code>leaf_labels</code></li>
<li><code>class</code></li>
</ul></section><section id="questions" class="slide level2 center"><h2>Questions</h2>
<ul>
<li><p>How to build the dendrogram?</p></li>
<li><p>How to choose the cut?</p></li>
</ul></section><section id="bird-eye-view-at-hierarchical-agglomerative-clustering-methods" class="slide level2 center scrollable"><h2>Bird-eye view at hierarchical agglomerative clustering methods</h2>
<h3 id="all-hierarchical-agglomerative-clustering-methods-hacms-can-be-described-by-the-following-general-algorithm.">All <a href="https://en.wikipedia.org/wiki/Hierarchical_clustering">hierarchical agglomerative clustering methods (HACMs)</a> can be described by the following general algorithm.</h3>
<ol type="1">
<li><p>At each stage distances between clusters are recomputed by the <em>Lance-Williams dissimilarity update formula</em> according to the particular clustering method being used.</p></li>
<li><p>Identify the 2 closest <em>points</em> and combine them into a cluster (treating existing clusters as points too)</p></li>
<li><p>If more than one cluster remains, return to step 1.</p></li>
</ol></section><section id="greed-is-good" class="slide level2 center"><h2>Greed is good!</h2>
<ul>
<li><p>Hierarchical agglomerative clustering methods are examples of <em>greedy algorithms</em></p></li>
<li>
<p>Greedy algorithms sometimes compute <em>optimal solutions</em></p>
<ul>
<li><p>Huffmann coding (Information Theory)</p></li>
<li><p>Minimum spanning tree (Graph algorithms)</p></li>
</ul>
</li>
<li>
<p>Greedy algorithms sometimes compute <em>sub-optimal solutions</em></p>
<ul>
<li><p>Set cover (NP-hard problem)</p></li>
<li><p>…</p></li>
</ul>
</li>
<li>
<p>Efficient greedy algorithms rely on ad hoc data structures</p>
<ul>
<li><p>Priority queues</p></li>
<li><p>Union-Find</p></li>
</ul>
</li>
</ul></section><section id="algorithm-detailed" class="slide level2 center"><h2>
<i class="fa-solid fa-binoculars" aria-label="binoculars"></i> Algorithm (detailed)</h2>
<ul>
<li><p>Start with <span class="math inline">\((\mathcal{C}_{i}^{(0)})= (\{ \vec{X}_i \})\)</span> the collection of all singletons.</p></li>
<li>
<p>At step <span class="math inline">\(s\)</span>, we have <span class="math inline">\(n-s\)</span> clusters <span class="math inline">\((\mathcal{C}_{i}^{(s)})\)</span>:</p>
<ul>
<li><p>Find the two most similar clusters according to a criterion <span class="math inline">\(\Delta\)</span>: <span class="math display">\[(i,i') = \operatorname{argmin}_{(j,j')} \Delta(\mathcal{C}_{j}^{(s)},\mathcal{C}_{j'}^{(s)})\]</span></p></li>
<li><p>Merge <span class="math inline">\(\mathcal{C}_{i}^{(s)}\)</span> and <span class="math inline">\(\mathcal{C}_{i'}^{(s)}\)</span> into <span class="math inline">\(\mathcal{C}_{i}^{(s+1)}\)</span></p></li>
<li><p>Keep the <span class="math inline">\(n-s-2\)</span> other clusters <span class="math inline">\(\mathcal{C}_{i''}^{(s+1)} = \mathcal{C}_{i''}^{(s)}\)</span></p></li>
</ul>
</li>
<li><p>Repeat until there is only one cluster left</p></li>
</ul></section><section id="analysis" class="slide level2 center"><h2>Analysis</h2>
<ul>
<li><p>Complexity: <span class="math inline">\(O(n^3)\)</span> in general.</p></li>
<li>
<p>Can be reduced to <span class="math inline">\(O(n^2)\)</span> (sometimes to <span class="math inline">\(O(n \log n)\)</span>)</p>
<ul>
<li><p>if the number of possible mergers for a given cluster is bounded.</p></li>
<li><p>for the most classical distances by maintaining a nearest neighbors list.</p></li>
</ul>
</li>
</ul></section><section id="merging-criterion-based-on-the-distance-between-points" class="slide level2 center"><h2>Merging criterion based on the distance between points</h2>
<h3 id="minimum-linkage">Minimum linkage:</h3>
<p><span class="math display">\[\Delta(\mathcal{C}_i, \mathcal{C}_j) =\min_{\vec{X}_i \in \mathcal{C}_i} \min_{\vec{X}_j \in    \mathcal{C}_j} d(\vec{X}_i, \vec{X}_j)\]</span></p>
<h3 id="maximum-linkage">Maximum linkage:</h3>
<p><span class="math display">\[\Delta(\mathcal{C}_i, \mathcal{C}_j) = \max_{\vec{X}_i \in \mathcal{C}_i} \max_{\vec{X}_j \in    \mathcal{C}_j} d(\vec{X}_i, \vec{X}_j)\]</span></p>
<h3 id="average-linkage">Average linkage:</h3>
<p><span class="math display">\[\Delta(\mathcal{C}_i, \mathcal{C}_j) =\frac{1}{|\mathcal{C}_i||\mathcal{C}_j|} \sum_{\vec{X}_i \in    \mathcal{C}_i}\sum_{\vec{X}_j \in \mathcal{C}_j} d(\vec{X}_i, \vec{X}_j)\]</span></p>
</section><section id="wards-criterion-minimum-varianceinertia-criterion" class="slide level2 center"><h2>Ward’s criterion : minimum variance/inertia criterion</h2>
<p><span class="math inline">\(\Delta(\mathcal{C}_i, \mathcal{C}_j) = \sum_{\vec{X}_i \in \mathcal{C}_i} \left( d^2(\vec{X}_i, \mu_{\mathcal{C}_i \cup \mathcal{C}_j} ) - d^2(\vec{X}_i, \mu_{\mathcal{C}_i}) \right) +\)</span></p>
<p><span class="math inline">\(\qquad\qquad \qquad \sum_{\vec{X}_j \in \mathcal{C}_j} \left( d^2(\vec{X}_j, \mu_{\mathcal{C}_i \cup \mathcal{C}_j} ) - d^2(\vec{X}_j, \mu_{\mathcal{C}_j}) \right)\)</span></p>
<h3 id="if-d-is-the-euclidean-distance">If <span class="math inline">\(d\)</span> is the euclidean distance</h3>
<p><span class="math display">\[\Delta(\mathcal{C}_i, \mathcal{C}_j) = \frac{ |\mathcal{C}_i||\mathcal{C}_j|}{|\mathcal{C}_i|+ |\mathcal{C}_j|} d^2(\mu_{\mathcal{C}_i}, \mu_{\mathcal{C}_j})\]</span></p>
</section><section id="lance-williams-update-formulae" class="slide level2 center"><h2>Lance-Williams update formulae</h2>
<p>Suppose that clusters <span class="math inline">\(C_{i}\)</span> and <span class="math inline">\(C_{j}\)</span> were next to be merged</p>
<p>At this point, all of the current pairwise cluster <em>distances</em> are known</p>
<p>The recursive update formula gives the updated cluster <em>distances</em> following the pending merge of clusters <span class="math inline">\(C_{i}\)</span> and <span class="math inline">\(C_{j}\)</span></p>
<p>Let</p>
<ul>
<li><p><span class="math inline">\(d_{ij}, d_{ik}\)</span>, and <span class="math inline">\(d_{jk}\)</span> be shortands for the pairwise <em>distances</em> between clusters <span class="math inline">\(C_{i}, C_{j}\)</span> and <span class="math inline">\(C_{k}\)</span></p></li>
<li><p><span class="math inline">\(d_{{(ij)k}}\)</span> be shortand for the <em>distance</em> between the new cluster <span class="math inline">\(C_{i}\cup C_{j}\)</span> and <span class="math inline">\(C_{k}\)</span> ( <span class="math inline">\(k\not\in \{i,j\}\)</span> )</p></li>
</ul></section><section id="lance-williams-update-formulae-continued" class="slide level2 center"><h2>Lance-Williams update formulae (continued)</h2>
<p>An algorithm belongs to the <em>Lance-Williams family</em> if the updated cluster <em>distance</em> <span class="math inline">\(d_{{(ij)k}}\)</span> can be computed recursively by</p>
<p><span class="math display">\[d_{(ij)k} = \alpha _{i}d_{ik}+ \alpha _{j}d_{jk}+ \beta d_{ij}+ \gamma |d_{ik}-d_{jk}|\]</span></p>
<p>where <span class="math inline">\(\alpha_{i},\alpha _{j},\beta\)</span> , and <span class="math inline">\(\gamma\)</span> are parameters, which may depend on cluster sizes, that together with the cluster <em>distance</em> function <span class="math inline">\(d_{ij}\)</span> determine the clustering algorithm.</p>
<aside class="notes"><p>Clustering algorithms such as</p>
<ul>
<li>single linkage,</li>
<li>complete linkage, and</li>
<li>group average</li>
</ul>
<p>method have a recursive formula of the above type</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside></section><section id="lance-williams-update-formula-for-wards-criterion" class="slide level2 center"><h2>Lance-Williams update formula for Ward’s criterion</h2>
<p><span class="math display">\[\begin{array}{rl}d\left(C_i \cup C_j, C_k\right) &amp; = \frac{n_i+n_k}{n_i+n_j+n_k}d\left(C_i, C_k\right)  +\frac{n_j+n_k}{n_i+n_j+n_k}d\left(C_j, C_k\right) \\ &amp; \phantom{==}- \frac{n_k}{n_i+n_j+n_k} d\left(C_i, C_j\right)\end{array}\]</span></p>
<p><span class="math display">\[\alpha_i = \frac{n_i+n_k}{n_i+n_j+n_k} \qquad \alpha_j = \frac{n_j+n_k}{n_i+n_j+n_k}\qquad \beta = \frac{- n_k}{n_i+n_j+n_k}\]</span></p>
</section><section id="an-unfair-quotation" class="slide level2 center"><h2>An unfair quotation</h2>
<blockquote>
<p>Ward’s minimum variance criterion minimizes the total within-cluster variance .fr[Wikipedia]</p>
</blockquote>
<ul>
<li><p>Is that correct?</p></li>
<li><p>If corrected, what does it mean?</p></li>
</ul>
<aside class="notes"><p>If we understand the statement as:</p>
<blockquote>
<p>for any <span class="math inline">\(k\)</span>, the flat clustering obtained by cutting the dendrogram so as to obtain a <span class="math inline">\(k\)</span>-clusters partition minimizes the total within-cluster variance/inertia amongst all <span class="math inline">\(k\)</span>-clusterings</p>
</blockquote>
<p>then, the statement is not proved. If it were proved, it would imply <span class="math inline">\(\mathsf{P}=\mathsf{NP}\)</span></p>
<p>The total within-cluster variance/inertia is the objective function in the <span class="math inline">\(k\)</span>-means problem.</p>
<p>The statement is misleading</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside></section><section id="what-happens-in-wards-method" class="slide level2 center"><h2>What happens in Ward’s method?</h2>
<blockquote>
<p>At each step find the pair of clusters that leads to minimum increase in total within-cluster variance after merging .fr[Wikipedia]</p>
</blockquote>
<blockquote>
<p>This increase is a weighted squared distance between cluster centers .fr[Wikipedia]</p>
</blockquote>
<blockquote>
<p>At the initial step, all clusters are singletons (clusters containing a single point). To apply a recursive algorithm under this objective function, the initial distance between individual objects must be (proportional to) squared Euclidean distance.</p>
</blockquote>
</section><section id="views-on-inertia" class="slide level2 center"><h2>Views on Inertia:</h2>
<p><span class="math display">\[I   = \frac{1}{n} \sum_{i=1}^n \|\vec{X}_i - \vec{m} \|^2\]</span></p>
<p>where <span class="math inline">\(\vec{m} = \sum_{i=1}^n \frac{1}{n}\vec{X}_i\)</span></p>
<p><span class="math display">\[I = \frac{1}{2n^2} \sum_{i,j} \|\vec{X}_i - \vec{X}_j\|^2\]</span></p>
<p>Twice the mean squared distance to the mean equals the mean squared distance between sample points</p>
<aside class="notes"><p>Recall that for a real random variable <span class="math inline">\(Z\)</span> with mean <span class="math inline">\(\mu\)</span></p>
<p><span class="math display">\[\operatorname{var}(Z) = \mathbb{E}(Z -m)^2 = \inf_a \mathbb{E}(Z -a)^2\]</span></p>
<p>and</p>
<p><span class="math display">\[\operatorname{var}(Z) = \frac{1}{2} \mathbb{E}(Z -Z')^2\]</span></p>
<p>where <span class="math inline">\(Z'\)</span> is an independent copy of <span class="math inline">\(Z\)</span></p>
<p>The different formulae for inertia is just mirroring the different views at variance</p>
<p>The inertia is the trace of an empirical covariance matrix.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside></section><section id="decompositions-of-inertia-huyghens-formula" class="slide level2 center"><h2>Decompositions of inertia (Huyghens formula)</h2>
<ul>
<li><p>Sample <span class="math inline">\(x_1,\ldots, x_{n+m}\)</span> with mean <span class="math inline">\(\bar{X}_{n+m}\)</span> and variance <span class="math inline">\(V\)</span></p></li>
<li><p>Partition <span class="math inline">\(\{1,\ldots,n+m\} = A \cup B\)</span> with <span class="math inline">\(|A|=n, |B|=m\)</span>, <span class="math inline">\(A \cap B =\emptyset\)</span></p></li>
<li><p>Let <span class="math inline">\(\bar{X}_n = \frac{1}{n}\sum_{i \in A} X_i\)</span> and <span class="math inline">\(\bar{X}_m=\frac{1}{m}\sum_{i \in B}X_i\)</span> <span class="math display">\[\bar{X}_{n+m} =  \frac{n}{n+m} \bar{X}_{n}  +\frac{m}{n+m} \bar{X}_{m}\]</span></p></li>
<li><p>Let <span class="math inline">\(V_A\)</span> be the variance of <span class="math inline">\((x_i)_{i\in A}\)</span>, <span class="math inline">\(V_B\)</span> be the variance of <span class="math inline">\((x_i)_{i\in B}\)</span></p></li>
</ul></section><section id="decompositions-of-inertia-huyghens-formula-1" class="slide level2 center"><h2>Decompositions of inertia (Huyghens formula)</h2>
<ul>
<li><p>Let <span class="math inline">\(V_{\text{between}}\)</span> be the variance of a ghost sample with <span class="math inline">\(n\)</span> copies of <span class="math inline">\(\bar{X}_n\)</span> and <span class="math inline">\(m\)</span> copies of <span class="math inline">\(\bar{X}_m\)</span> <span class="math display">\[V_{\text{between}} =  \frac{n}{n+m} (\bar{X}_n -\bar{X}_{n+m})^2 + \frac{m}{n+m} (\bar{X}_m -\bar{X}_{n+m})^2\]</span></p></li>
<li><p>Let <span class="math inline">\(V_{\text{within}}\)</span> be the weighted mean of variances within classes <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> <span class="math display">\[V_{\text{within}}  = \frac{n}{n+m}  V_A + \frac{m}{n+m} V_B\]</span></p></li>
</ul></section><section id="decompositions-of-inertia" class="slide level2 center"><h2>Decompositions of inertia</h2>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Proposition: Huyghens formula I</strong></p>
</div>
<div class="callout-content">
<p><span class="math display">\[V = V_{\text{within}} +  V_{\text{between}}\]</span></p>
</div>
</div>
</div>
</section><section id="huyghens-formula-can-be-extended-to-any-number-of-classes" class="slide level2 center"><h2>Huyghens formula can be extended to any number of classes</h2>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Proposition: Huyghens (II)</strong></p>
</div>
<div class="callout-content">
<ul>
<li><p>Sample <span class="math inline">\(\vec{x}_1, \ldots,\vec{x}_n\)</span> from <span class="math inline">\(\mathbb{R}^p\)</span> with mean <span class="math inline">\(\bar{X}_n\)</span>, inertia <span class="math inline">\(I\)</span>.</p></li>
<li><p>Let <span class="math inline">\(A_1, A_2\ldots, A_k\)</span> be a partition of <span class="math inline">\(\{1,\ldots,n\}\)</span>.</p></li>
<li><p>Let <span class="math inline">\(I_\ell\)</span> (resp. <span class="math inline">\(\bar{X}^\ell\)</span>) be the inertia (resp. the mean) of sub-sample <span class="math inline">\(\vec{x}_i, i\in A_\ell\)</span></p></li>
<li><p>Let <span class="math inline">\(I_{\text{between}}\)</span> be the inertia of the ghost sample, formed by <span class="math inline">\(|A_1|\)</span> copies of <span class="math inline">\(\bar{X}^1\)</span>, <span class="math inline">\(|A_2|\)</span> copies of <span class="math inline">\(\bar{X}^2\)</span>, … <span class="math inline">\(|A_k|\)</span> copies of <span class="math inline">\(\bar{X}^k\)</span></p></li>
<li><p>Let <span class="math inline">\(I_{\text{within}} =  \sum_{\ell=1}^k \frac{|A_\ell|}{n}  I_\ell\)</span></p></li>
</ul>
<p><span class="math display">\[I =   I_{\text{within}} +  I_{\text{between}}\]</span></p>
</div>
</div>
</div>
</section></section><section><section id="comparing-dendrograms" class="title-slide slide level1 center" data-background-color="#1c191c"><h1>Comparing dendrograms</h1>

</section><section id="cophenetic-disimilarity" class="slide level2 center"><h2>Cophenetic disimilarity</h2>
<p>Given a dendrogram, the <em>cophenetic</em> disimilarity between two sample points <span class="math inline">\(x, x'\)</span> is the intergroup disimilarity at which observations <span class="math inline">\(x\)</span> and <span class="math inline">\(x'\)</span> are first joined.</p>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Proposition</strong></p>
</div>
<div class="callout-content">
<p>A cophenetic disimilarity has the <em>ultrametric</em> property</p>
</div>
</div>
</div>

<aside><div>
<p>All triangles are isoceles and the unequal length should be no longer than the length of the two equal sides</p>
</div></aside></section><section id="cophenetic-correlation-coefficient" class="slide level2 center"><h2>Cophenetic correlation coefficient</h2>
<p>The cophenetic correlation coefficient measures how faithfully a dendrogram preserves the pairwise distances between the original unmodeled data points</p>

<aside><div>
<p><a href="https://en.wikipedia.org/wiki/Cophenetic_correlation">wikipedia</a>]</p>
</div></aside></section><section id="computing-cophenetic-correlation-coefficient" class="slide level2 center"><h2>Computing cophenetic correlation coefficient</h2>
<p>In <i class="fa-brands fa-r-project" aria-label="r-project"></i> use the <code>dendextend</code> package</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<colgroup>
<col style="width: 10%">
<col style="width: 14%">
<col style="width: 12%">
<col style="width: 14%">
<col style="width: 10%">
<col style="width: 14%">
<col style="width: 10%">
<col style="width: 12%">
</colgroup>
<thead><tr class="header">
<th style="text-align: right;">single</th>
<th style="text-align: right;">complete</th>
<th style="text-align: right;">average</th>
<th style="text-align: right;">mcquitty</th>
<th style="text-align: right;">ward.D</th>
<th style="text-align: right;">centroid</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">ward.D2</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: right;">0.86</td>
<td style="text-align: right;">0.73</td>
<td style="text-align: right;">0.88</td>
<td style="text-align: right;">0.87</td>
<td style="text-align: right;">0.86</td>
<td style="text-align: right;">0.87</td>
<td style="text-align: right;">0.86</td>
<td style="text-align: right;">0.87</td>
</tr></tbody>
</table>
</div>
</div>
</section><section id="section-13" class="slide level2 center"><h2></h2>

<img data-src="slides-hclust_files/figure-revealjs/unnamed-chunk-14-1.png" width="960" class="r-stretch"></section><section id="how-to-apply-general-algorithm" class="slide level2 center"><h2>How to apply general algorithm?</h2>
<ul>
<li><p>Lance-Williams dissimilarity update formula calculates dissimilarities between a new cluster and existing points, based on the dissimilarities prior to forming the new cluster</p></li>
<li><p>This formula has 3 parameters</p></li>
<li><p>Each HACM is characterized by its own set of Lance-Williams parameters</p></li>
</ul></section><section id="implementations-of-the-general-algorithm" class="slide level2 center"><h2>Implementations of the general algorithm</h2>
<h3 id="stored-matrix-approach">Stored matrix approach</h3>
<p>Use matrix, and then apply Lance-Williams to recalculate dissimilarities between cluster centers. Storage <span class="math inline">\(O(N^2)\)</span> and time at least <span class="math inline">\(O(N^2)\)</span>, but is <span class="math inline">\(\Theta(N^3)\)</span> if matrix is scanned linearly</p>
<h3 id="stored-data-approach">Stored data approach</h3>
<p><span class="math inline">\(O(N)\)</span> space for data but recompute pairwise dissimilarities, needs <span class="math inline">\(\Theta(N^3)\)</span> time</p>
<h3 id="sorted-matrix-approach">Sorted matrix approach</h3>
<p><span class="math inline">\(O(N^2)\)</span> to calculate dissimilarity matrix, <span class="math inline">\(O(N^2 \log N)\)</span> to sort it, <span class="math inline">\(O(N^2)\)</span> to construct hierarchy, but one need not store the data set, and the matrix can be processed linearly, which reduces disk accesses</p>
</section><section id="agglomerative-clustering-heuristic" class="slide level2 center"><h2>Agglomerative Clustering Heuristic</h2>
<ul>
<li><p>Start with very small clusters (a sample point by cluster?)</p></li>
<li><p>Merge iteratively the most similar clusters according to some <em>greedy</em> criterion <span class="math inline">\(\Delta\)</span>.</p></li>
<li><p>Generates a <em>hierarchy of clusterings</em> instead of a single one.</p></li>
<li><p>Need to select the number of cluster afterwards.</p></li>
<li><p>Several choice for the merging criterion</p></li>
<li>
<p>Examples:</p>
<ul>
<li><p><em>Minimum Linkage</em>: merge the closest cluster in term of the usual distance</p></li>
<li><p><em>Ward’s criterion</em>: merge the two clusters yielding the less inner inertia loss (minimum variance criterion)</p></li>
</ul>
</li>
</ul></section><section id="packages" class="slide level2 center"><h2>Packages</h2>
<ul>
<li>
<svg aria-hidden="true" role="img" viewbox="0 0 581 512" style="height:1em;width:1.13em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"></path></svg><ul>
<li><a href="https://cran.r-project.org/web/packages/ggdendro/vignettes/ggdendro.html"><code>ggdendro</code></a></li>
<li><a href="https://cran.r-project.org/web/packages/dendextend/vignettes/dendextend.html"><code>dendextend</code></a></li>
<li><a href="https://cran.r-project.org/web/packages/dendroextras/index.html"><code>dendroextras</code></a></li>
</ul>
</li>
<li>
<svg aria-hidden="true" role="img" viewbox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;"><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"></path></svg><ul>
<li><a href="https://docs.scipy.org/doc/scipy/reference/cluster.hierarchy.html"><code>scipy</code></a></li>
<li><a href="https://scikit-learn.org/stable/modules/clustering.html#hierarchical-clustering"><code>scikit-learn</code></a></li>
</ul>
</li>
</ul></section></section><section id="the-end" class="title-slide slide level1 center" data-background-color="#1c191c"><h1>The End</h1>


<div class="reveal-header">
<div class="header-logo" data-header-logo-link="https://u-paris.fr">
<img data-src="../../images/logo.png">
</div>
<div class="sc-title">
<p> </p>
</div>
<div class="header-text">
<p>Hierarchical Clustering</p>
</div>
<div class="sb-title">
<p> </p>
</div>
</div>
</section>
</div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="../../images/UniversiteParis_monogramme_couleur_RVB.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="http://s-v-b.github.io/MA7BY020">MA7BY020</a> – Analyse de Données – M1 MIDS – UParis Cité</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="../../site_libs/revealjs/dist/reveal.js"></script><!-- reveal.js plugins --><script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script><script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script><script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script><script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script><script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script><script src="../../site_libs/revealjs/plugin/notes/notes.js"></script><script src="../../site_libs/revealjs/plugin/search/search.js"></script><script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script><script src="../../site_libs/revealjs/plugin/math/math.js"></script><script>window.define = window.backupDefine; window.backupDefine = undefined;</script><script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: true,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: true,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script><script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script><script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/s-v-b\.github\.io\/MA7BY020\/");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
                // target, if specified
                link.setAttribute("target", "_blank");
                if (link.getAttribute("rel") === null) {
                  link.setAttribute("rel", "noopener");
                }
                // default icon
                link.classList.add("external");
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
            let selectedAnnoteEl;
            const selectorForAnnotation = ( cell, annotation) => {
              let cellAttr = 'data-code-cell="' + cell + '"';
              let lineAttr = 'data-code-annotation="' +  annotation + '"';
              const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
              return selector;
            }
            const selectCodeLines = (annoteEl) => {
              const doc = window.document;
              const targetCell = annoteEl.getAttribute("data-target-cell");
              const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
              const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
              const lines = annoteSpan.getAttribute("data-code-lines").split(",");
              const lineIds = lines.map((line) => {
                return targetCell + "-" + line;
              })
              let top = null;
              let height = null;
              let parent = null;
              if (lineIds.length > 0) {
                  //compute the position of the single el (top and bottom and make a div)
                  const el = window.document.getElementById(lineIds[0]);
                  top = el.offsetTop;
                  height = el.offsetHeight;
                  parent = el.parentElement.parentElement;
                if (lineIds.length > 1) {
                  const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
                  const bottom = lastEl.offsetTop + lastEl.offsetHeight;
                  height = bottom - top;
                }
                if (top !== null && height !== null && parent !== null) {
                  // cook up a div (if necessary) and position it 
                  let div = window.document.getElementById("code-annotation-line-highlight");
                  if (div === null) {
                    div = window.document.createElement("div");
                    div.setAttribute("id", "code-annotation-line-highlight");
                    div.style.position = 'absolute';
                    parent.appendChild(div);
                  }
                  div.style.top = top - 2 + "px";
                  div.style.height = height + 4 + "px";
                  div.style.left = 0;
                  let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
                  if (gutterDiv === null) {
                    gutterDiv = window.document.createElement("div");
                    gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                    gutterDiv.style.position = 'absolute';
                    const codeCell = window.document.getElementById(targetCell);
                    const gutter = codeCell.querySelector('.code-annotation-gutter');
                    gutter.appendChild(gutterDiv);
                  }
                  gutterDiv.style.top = top - 2 + "px";
                  gutterDiv.style.height = height + 4 + "px";
                }
                selectedAnnoteEl = annoteEl;
              }
            };
            const unselectCodeLines = () => {
              const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
              elementsIds.forEach((elId) => {
                const div = window.document.getElementById(elId);
                if (div) {
                  div.remove();
                }
              });
              selectedAnnoteEl = undefined;
            };
              // Handle positioning of the toggle
          window.addEventListener(
            "resize",
            throttle(() => {
              elRect = undefined;
              if (selectedAnnoteEl) {
                selectCodeLines(selectedAnnoteEl);
              }
            }, 10)
          );
          function throttle(fn, ms) {
          let throttle = false;
          let timer;
            return (...args) => {
              if(!throttle) { // first call gets through
                  fn.apply(this, args);
                  throttle = true;
              } else { // all the others get throttled
                  if(timer) clearTimeout(timer); // cancel #2
                  timer = setTimeout(() => {
                    fn.apply(this, args);
                    timer = throttle = false;
                  }, ms);
              }
            };
          }
            const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
            for (let i=0; i<annoteTargets.length; i++) {
              const annoteTarget = annoteTargets[i];
              const targetCell = annoteTarget.getAttribute("data-target-cell");
              const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
              const contentFn = () => {
                const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
                if (content) {
                  const tipContent = content.cloneNode(true);
                  tipContent.classList.add("code-annotation-tip-content");
                  return tipContent.outerHTML;
                }
              }
              const config = {
                allowHTML: true,
                content: contentFn,
                onShow: (instance) => {
                  selectCodeLines(instance.reference);
                  instance.reference.classList.add('code-annotation-active');
                  window.tippy.hideAll();
                },
                onHide: (instance) => {
                  unselectCodeLines();
                  instance.reference.classList.remove('code-annotation-active');
                },
                maxWidth: 300,
                delay: [50, 0],
                duration: [200, 0],
                offset: [5, 10],
                arrow: true,
                appendTo: function(el) {
                  return el.parentElement.parentElement.parentElement;
                },
                interactive: true,
                interactiveBorder: 10,
                theme: 'light-border',
                placement: 'right',
                popperOptions: {
                  modifiers: [
                  {
                    name: 'flip',
                    options: {
                      flipVariations: false, // true by default
                      allowedAutoPlacements: ['right'],
                      fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                    },
                  },
                  {
                    name: 'preventOverflow',
                    options: {
                      mainAxis: false,
                      altAxis: false
                    }
                  }
                  ]        
                }      
              };
              window.tippy(annoteTarget, config); 
            }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script><script type="text/javascript">
        (function(d) {
          d.querySelectorAll(".pseudocode-container").forEach(function(el) {
            let pseudocodeOptions = {
              indentSize: el.dataset.indentSize || "1.2em",
              commentDelimiter: el.dataset.commentDelimiter || "//",
              lineNumber: el.dataset.lineNumber === "true" ? true : false,
              lineNumberPunc: el.dataset.lineNumberPunc || ":",
              noEnd: el.dataset.noEnd === "true" ? true : false,
              titlePrefix: el.dataset.captionPrefix || "Algorithm"
            };
            pseudocode.renderElement(el.querySelector(".pseudocode"), pseudocodeOptions);
          });
        })(document);
        (function(d) {
          d.querySelectorAll(".pseudocode-container").forEach(function(el) {
            let captionSpan = el.querySelector(".ps-root > .ps-algorithm > .ps-line > .ps-keyword")
            if (captionSpan !== null) {
              let captionPrefix = el.dataset.captionPrefix + " ";
              let captionNumber = "";
              if (el.dataset.pseudocodeNumber) {
                captionNumber = el.dataset.pseudocodeNumber + " ";
                if (el.dataset.chapterLevel) {
                  captionNumber = el.dataset.chapterLevel + "." + captionNumber;
                }
              }
              captionSpan.innerHTML = captionPrefix + captionNumber;
            }
          });
        })(document);
        </script>


</body></html>