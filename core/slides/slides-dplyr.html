<!DOCTYPE html>
<html lang="en-US"><head>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/tabby.min.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-a6e161b2431e1f94a14e0f5d32135a3c.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/quarto-contrib/reveal-header-1.0.0/add_header.js" defer="true"></script>
<link href="../../site_libs/quarto-contrib/reveal-header-1.0.0/add_header.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/grid-htext-1.0.0/grid_htext.css" rel="stylesheet">
<script src="../../site_libs/quarto-contrib/pseudocode-2.4.1/pseudocode.min.js"></script>
<link href="../../site_libs/quarto-contrib/pseudocode-2.4.1/pseudocode.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">
<meta name="author" content="Équipe EAD">
<meta name="dcterms.date" content="2021-12-21">
<title>MA7BY020 - Spring 2026 – Tables manipulation with dplyr</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
<link rel="stylesheet" href="../../site_libs/revealjs/dist/reset.css">
<link rel="stylesheet" href="../../site_libs/revealjs/dist/reveal.css">
<style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #24292e;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #24292e; } /* Normal */
    code span.al { color: #ff5555; font-weight: bold; } /* Alert */
    code span.an { color: #6a737d; } /* Annotation */
    code span.at { color: #d73a49; } /* Attribute */
    code span.bn { color: #005cc5; } /* BaseN */
    code span.bu { color: #d73a49; } /* BuiltIn */
    code span.cf { color: #d73a49; } /* ControlFlow */
    code span.ch { color: #032f62; } /* Char */
    code span.cn { color: #005cc5; } /* Constant */
    code span.co { color: #6a737d; } /* Comment */
    code span.cv { color: #6a737d; } /* CommentVar */
    code span.do { color: #6a737d; } /* Documentation */
    code span.dt { color: #d73a49; } /* DataType */
    code span.dv { color: #005cc5; } /* DecVal */
    code span.er { color: #ff5555; text-decoration: underline; } /* Error */
    code span.ex { color: #d73a49; font-weight: bold; } /* Extension */
    code span.fl { color: #005cc5; } /* Float */
    code span.fu { color: #6f42c1; } /* Function */
    code span.im { color: #032f62; } /* Import */
    code span.in { color: #6a737d; } /* Information */
    code span.kw { color: #d73a49; } /* Keyword */
    code span.op { color: #24292e; } /* Operator */
    code span.ot { color: #6f42c1; } /* Other */
    code span.pp { color: #d73a49; } /* Preprocessor */
    code span.re { color: #6a737d; } /* RegionMarker */
    code span.sc { color: #005cc5; } /* SpecialChar */
    code span.ss { color: #032f62; } /* SpecialString */
    code span.st { color: #032f62; } /* String */
    code span.va { color: #e36209; } /* Variable */
    code span.vs { color: #032f62; } /* VerbatimString */
    code span.wa { color: #ff5555; } /* Warning */
  </style>
<link rel="stylesheet" href="../../site_libs/revealjs/dist/theme/quarto-970bcd7a187d3050da7c0c3921783a49.css">
<link href="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
<link href="../../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
<link href="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
<link href="../../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
<style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
<script>
  MathJax = {
    loader: {
      load: ['[tex]/boldsymbol']
    },
    tex: {
      tags: "all",
      inlineMath: [['$','$'], ['\\(','\\)']],
      displayMath: [['$$','$$'], ['\\[','\\]']],
      processEscapes: true,
      processEnvironments: true,
      packages: {
        '[+]': ['boldsymbol']
      }
    }
  };
  </script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
<meta property="og:title" content="Tables manipulation with dplyr – MA7BY020 - Spring 2026">
<meta property="og:description" content="Analyse de Données Master MIDS">
<meta property="og:site_name" content="MA7BY020 - Spring 2026">
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-color="#1c191c" class="quarto-title-block center"><h1 class="title">Tables manipulation with dplyr</h1>
  <p class="subtitle"><a href="https://s-v-b.github.io/MA7BY020/">Analyse de Données Master MIDS</a></p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Équipe EAD 
</div>
        <p class="quarto-title-affiliation">
            <a href="https://u-paris.fr">LPSM Université Paris-Cité</a>
          </p>
    </div>
</div>

  <p class="date">2021-12-21</p>
</section><section id="TOC"><nav role="doc-toc"><h2 id="toc-title">Roadmap</h2>
<ul>
<li><a href="#/tables" id="/toc-tables">Tables</a></li>
<li><a href="#/sql-and-relational-algebra-with-dplyr" id="/toc-sql-and-relational-algebra-with-dplyr">SQL and Relational algebra with <code>dplyr</code></a></li>
<li><a href="#/joins-multi-table-queries" id="/toc-joins-multi-table-queries">Joins : multi-table queries</a></li>
<li><a href="#/creating-new-columns" id="/toc-creating-new-columns">Creating new columns</a></li>
<li><a href="#/tidy-tables" id="/toc-tidy-tables">Tidy tables</a></li>
<li><a href="#/aggregations" id="/toc-aggregations">Aggregations</a></li>
<li><a href="#/window-queries" id="/toc-window-queries">Window queries</a></li>
<li><a href="#/pipelineschaining-operations" id="/toc-pipelineschaining-operations">Pipelines/chaining operations</a></li>
<li><a href="#/pandas-python-versus-r-dataframes-in-words" id="/toc-pandas-python-versus-r-dataframes-in-words">Pandas (Python) versus <code>R</code> dataframes : in words</a></li>
<li><a href="#/the-end" id="/toc-the-end">The End</a></li>
</ul></nav></section><section><section id="tables" class="title-slide slide level1 center" data-background-color="#1c191c"><h1>Tables</h1>

</section><section id="tables-examples" class="slide level2 center"><h2>Tables (examples)</h2>
<ul>
<li><p>Speadsheets (Excel)</p></li>
<li><p><i class="fa-solid fa-database" aria-label="database"></i> Relational tables</p></li>
<li>
<p>Dataframes in datascience frameworks</p>
<ul>
<li>
<i class="fa-brands fa-r-project" aria-label="r-project"></i>: <code>data.frame</code>, <code>tibble</code>, …</li>
<li>
<i class="fa-brands fa-python" aria-label="python"></i>: <code>pandas.dataframe</code>
</li>
<li>
<code>spark</code>: <code>dataframe</code>
</li>
<li>
<code>Dask</code>: <code>dataframe</code>
</li>
<li>and many others</li>
</ul>
</li>
</ul></section><section id="tables-why" class="slide level2 center"><h2>Tables (Why ?)</h2>
<p>In Data Science, each framework comes with its own flavor(s) of table(s)</p>
<p><i class="fa-solid fa-database" aria-label="database"></i> Tables from relational databases serve as inspiration</p>
<p>In <i class="fa-brands fa-r-project" aria-label="r-project"></i> legacy dataframes shape the life of statisticians and data scientists</p>
<p>The purpose of this session is</p>
<ul>
<li><p>describe dataframes from an end-user viewpoint (we leave aside implementations)</p></li>
<li>
<p>presenting tools for</p>
<ul>
<li>accessing information within dataframes (<em>querying</em>)</li>
<li>summarizing information (<em>aggregation queries</em>)</li>
<li>cleaning/cleaning dataframes (<em>tidying</em>)</li>
</ul>
</li>
</ul></section><section id="loading-tables-and-packages" class="slide level2 center"><h2>Loading tables and packages</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="fu">require</span>(<span class="st">"tidyverse"</span>)      <span class="co"># All we need is there</span></span>
<span id="cb1-2"><a></a><span class="fu">require</span>(<span class="st">"nycflights13"</span>)    <span class="co"># for flight data</span></span>
<span id="cb1-3"><a></a><span class="fu">require</span>(<span class="st">"gt"</span>)</span>
<span id="cb1-4"><a></a><span class="fu">require</span>(<span class="st">"kableExtra"</span>)</span>
<span id="cb1-5"><a></a><span class="co"># </span></span>
<span id="cb1-6"><a></a><span class="fu">data</span>(flights)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section><section id="about-loaded-packages" class="slide level2 center"><h2>About loaded packages</h2>
<ul>
<li><p>Metapackage <a href="https://www.tidyverse.org"><code>tidyverse</code></a> provides tools to create, query, tidy dataframes as well as tools to load data from various sources and save them in persistent storage</p></li>
<li><p><a href="https://github.com/tidyverse/nycflights13"><code>nycflights13</code></a> provides the dataframes we play with</p></li>
<li><p><a href="https://gt.rstudio.com"><code>gt</code></a> for tayloring table displays</p></li>
</ul></section><section id="the-flights-table" class="slide level2 center"><h2>The <code>flights</code> table</h2>
<div class="columns">
<div class="column">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a><span class="fu">head</span>(flights) <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a></a>  <span class="fu">glimpse</span>(<span class="at">width =</span> <span class="dv">30</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 6
Columns: 19
$ year           &lt;int&gt; 2013,…
$ month          &lt;int&gt; 1, 1,…
$ day            &lt;int&gt; 1, 1,…
$ dep_time       &lt;int&gt; 517, …
$ sched_dep_time &lt;int&gt; 515, …
$ dep_delay      &lt;dbl&gt; 2, 4,…
$ arr_time       &lt;int&gt; 830, …
$ sched_arr_time &lt;int&gt; 819, …
$ arr_delay      &lt;dbl&gt; 11, 2…
$ carrier        &lt;chr&gt; "UA",…
$ flight         &lt;int&gt; 1545,…
$ tailnum        &lt;chr&gt; "N142…
$ origin         &lt;chr&gt; "EWR"…
$ dest           &lt;chr&gt; "IAH"…
$ air_time       &lt;dbl&gt; 227, …
$ distance       &lt;dbl&gt; 1400,…
$ hour           &lt;dbl&gt; 5, 5,…
$ minute         &lt;dbl&gt; 15, 2…
$ time_hour      &lt;dttm&gt; 2013…</code></pre>
</div>
</div>
</div><div class="column">
<ul>
<li><p>A dataframe is a two-ways (two-dimensional) table</p></li>
<li><p><code>head(df)</code> displays the first 6 rows of its first argument</p></li>
<li><p>The vectors making a dataframe may have different types/classes (a dataframe is not a matrix)</p></li>
<li><p>Compare <code><a href="https://rdrr.io/r/utils/str.html">str()</a></code>, <code>glimpse()</code>, <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code></p></li>
</ul>
</div></div>
</section><section id="table-schema" class="slide level2 center"><h2>Table schema</h2>
<p>A table is a <em>list</em> of <em>columns</em></p>
<p>Each <em>column</em> has</p>
<ul>
<li>
<em>name</em> and</li>
<li>
<em>type</em> (<em>class</em> in <i class="fa-brands fa-r-project" aria-label="r-project"></i>
</li>
</ul>
<div class="cell columns column-output-location">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a><span class="fu">glimpse</span>(flights,   <span class="co">#&lt;&lt;</span></span>
<span id="cb4-2"><a></a>        <span class="at">width=</span><span class="dv">50</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 336,776
Columns: 19
$ year           &lt;int&gt; 2013, 2013, 2013, 2013, 2…
$ month          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ day            &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ dep_time       &lt;int&gt; 517, 533, 542, 544, 554, …
$ sched_dep_time &lt;int&gt; 515, 529, 540, 545, 600, …
$ dep_delay      &lt;dbl&gt; 2, 4, 2, -1, -6, -4, -5, …
$ arr_time       &lt;int&gt; 830, 850, 923, 1004, 812,…
$ sched_arr_time &lt;int&gt; 819, 830, 850, 1022, 837,…
$ arr_delay      &lt;dbl&gt; 11, 20, 33, -18, -25, 12,…
$ carrier        &lt;chr&gt; "UA", "UA", "AA", "B6", "…
$ flight         &lt;int&gt; 1545, 1714, 1141, 725, 46…
$ tailnum        &lt;chr&gt; "N14228", "N24211", "N619…
$ origin         &lt;chr&gt; "EWR", "LGA", "JFK", "JFK…
$ dest           &lt;chr&gt; "IAH", "IAH", "MIA", "BQN…
$ air_time       &lt;dbl&gt; 227, 227, 160, 183, 116, …
$ distance       &lt;dbl&gt; 1400, 1416, 1089, 1576, 7…
$ hour           &lt;dbl&gt; 5, 5, 5, 5, 6, 5, 6, 6, 6…
$ minute         &lt;dbl&gt; 15, 29, 40, 45, 0, 58, 0,…
$ time_hour      &lt;dttm&gt; 2013-01-01 05:00:00, 201…</code></pre>
</div>
</div></div>
</section><section id="section" class="slide level2 center"><h2></h2>
<ul>
<li>
<code>flights</code> has 19 columns</li>
<li>Each column is a sequence (<code>vector</code>) of items with the same type/class</li>
<li>All columns have the same length</li>
<li>
<code>flights</code> has 336776 rows</li>
<li>In <i class="fa-solid fa-database" aria-label="database"></i> parlance, a row is (often) called a <em>tuple</em>
</li>
<li>In <i class="fa-solid fa-database" aria-label="database"></i> parlance, a column is (often) called a <em>variable</em>
</li>
</ul></section><section id="column-types" class="slide level2 center"><h2>Column types</h2>
<div class="columns">
<div class="column">
<table class="caption-top">
<colgroup>
<col style="width: 40%">
<col style="width: 60%">
</colgroup>
<thead><tr class="header">
<th style="text-align: center;">class</th>
<th style="text-align: left;">columns</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>integer</code></td>
<td style="text-align: left;">‘year’ ‘month’ ‘day’ ‘dep_time’ ‘sched_dep_time’ ‘arr_time’ ‘sched_arr_time’ ‘flight’</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>numeric</code></td>
<td style="text-align: left;">‘dep_delay’ ‘arr_delay’ ‘air_time’ ‘distance’ ‘hour’ ‘minute’</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>character</code></td>
<td style="text-align: left;">‘carrier’ ‘tailnum’ ‘origin’ ‘dest’</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>POSIXct</code></td>
<td style="text-align: left;">‘time_hour’</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>POSIXt</code></td>
<td style="text-align: left;">‘time_hour’</td>
</tr>
</tbody>
</table>
</div><div class="column">
<p>A column, as a vector, may be belong to different classes</p>
<p>Other classes: <code>factor</code> for categorical variables</p>
<p>Columns <code>dest</code>, <code>origin</code> <code>carrier</code> could be coerced as factors</p>
<p>Should columns <code>dest</code> and <code>origin</code> be coerced to the same factor?</p>
</div></div>
</section><section id="nycflights13" class="slide level2 center"><h2><code>nycflights13</code></h2>
<div class="center">
<p><img data-src="../../images/schema-nycflights.png" style="width:40.0%"></p>
</div>
</section><section id="columns-specification" class="slide level2 center"><h2>Columns specification</h2>
<div class="columns">
<div class="column" style="width:30%;">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a><span class="fu">as.col_spec</span>(flights)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a><span class="fu">cols</span>(</span>
<span id="cb7-2"><a></a>  <span class="at">year =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb7-3"><a></a>  <span class="at">month =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb7-4"><a></a>  <span class="at">day =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb7-5"><a></a>  <span class="at">dep_time =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb7-6"><a></a>  <span class="at">sched_dep_time =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb7-7"><a></a>  <span class="at">dep_delay =</span> <span class="fu">col_double</span>(),</span>
<span id="cb7-8"><a></a>  <span class="at">arr_time =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb7-9"><a></a>  <span class="at">sched_arr_time =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb7-10"><a></a>  <span class="at">arr_delay =</span> <span class="fu">col_double</span>(),</span>
<span id="cb7-11"><a></a>  <span class="at">carrier =</span> <span class="fu">col_character</span>(),</span>
<span id="cb7-12"><a></a>  <span class="at">flight =</span> <span class="fu">col_integer</span>(),</span>
<span id="cb7-13"><a></a>  <span class="at">tailnum =</span> <span class="fu">col_character</span>(),</span>
<span id="cb7-14"><a></a>  <span class="at">origin =</span> <span class="fu">col_character</span>(),</span>
<span id="cb7-15"><a></a>  <span class="at">dest =</span> <span class="fu">col_character</span>(),</span>
<span id="cb7-16"><a></a>  <span class="at">air_time =</span> <span class="fu">col_double</span>(),</span>
<span id="cb7-17"><a></a>  <span class="at">distance =</span> <span class="fu">col_double</span>(),</span>
<span id="cb7-18"><a></a>  <span class="at">hour =</span> <span class="fu">col_double</span>(),</span>
<span id="cb7-19"><a></a>  <span class="at">minute =</span> <span class="fu">col_double</span>(),</span>
<span id="cb7-20"><a></a>  <span class="at">time_hour =</span> <span class="fu">col_datetime</span>(<span class="at">format =</span> <span class="st">""</span>)</span>
<span id="cb7-21"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div></div>
</section><section id="section-1" class="slide level2 center"><h2></h2>
<p><span class="math inline">\(\approx\)</span> table schema in relational databases</p>
<p>Column specifications are useful when loading dataframes from structured text files like <code>.csv</code> files</p>
<p><code>.csv</code> files do not contain typing information</p>
<p>File loaders from package <code>readr</code> can be tipped about column classes using column specifications</p>
</section></section><section><section id="sql-and-relational-algebra-with-dplyr" class="title-slide slide level1 center" data-background-color="#1c191c"><h1>SQL and Relational algebra with <code>dplyr</code>
</h1>

</section><section id="section-2" class="slide level2 center"><h2><i class="fa-solid fa-syringe" aria-label="syringe"></i></h2>
<ul>
<li><p>SQL stands for structured/simple Query Language</p></li>
<li><p>A query language elaborated during the 1970’s at IBM by E. Codd</p></li>
<li><p>Geared towards exploitation of collections of relational tables</p></li>
<li><p>Less powerful but simpler to use than a programming language</p></li>
<li><p><code>dplyr</code> is a principled <i class="fa-brands fa-r-project" aria-label="r-project"></i>-friendly implementation of SQL ideas (and other things)</p></li>
</ul>
<p>At the core of SQL lies the idea of a table calculus called <strong>relational algebra</strong></p>
</section><section id="relational-algebra-basics" class="slide level2 center"><h2>Relational algebra (basics)</h2>
<p>Convention: <span class="math inline">\(R\)</span> is a table with columns <span class="math inline">\(A_1, \ldots, A_k\)</span></p>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Projection (picking columns)</strong></p>
</div>
<div class="callout-content">
<p><span class="math inline">\(\pi(R, A_1, A_3)\)</span></p>
</div>
</div>
</div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Selection/Filtering (picking rows)</strong></p>
</div>
<div class="callout-content">
<p><span class="math inline">\(\sigma(R, {\text{condition}})\)</span></p>
</div>
</div>
</div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Join (mulitple tables operation)</strong></p>
</div>
<div class="callout-content">
<p><span class="math inline">\(\bowtie(R,S, {\text{condition}})\)</span></p>
</div>
</div>
</div>
<p><i class="fa-solid fa-hand-point-right" aria-label="hand-point-right"></i> Any operation produces a table</p>
<p><i class="fa-solid fa-hand-point-right" aria-label="hand-point-right"></i> The schema of the derived table depends on the operation (but does not depend on the content/value of the operands)</p>
</section><section id="section-3" class="slide level2 center"><h2></h2>
<p>Table calculus relies on a small set of basic operations <span class="math inline">\(\pi, \sigma, \bowtie\)</span></p>
<p>Each operation has one or two table <strong>operands</strong> and produce a table</p>
<p><i class="fa-solid fa-exclamation-triangle" aria-label="exclamation-triangle"></i> There is more to SQL than relational algebra</p>
</section><section id="projection-pi" class="slide level2 center"><h2>Projection <span class="math inline">\(\pi\)</span>
</h2>
<p><span class="math inline">\(\pi(R, {A_1, A_3})\)</span></p>
<p>A projection <span class="math inline">\(\pi(\cdot, {A_1, A_3})\)</span> is defined by a set of column names, say <span class="math inline">\(A_1, A_3\)</span></p>
<p>If <span class="math inline">\(R\)</span> has columns with given names, the result is a table with names <span class="math inline">\(A_1, A_3\)</span> and one row per row of <span class="math inline">\(R\)</span></p>
<p>A projection is parametrized by a list of column names</p>
</section><section id="package-dplyr" class="slide level2 center"><h2>
<i class="fa-solid fa-tools" aria-label="tools"></i> Package <code>dplyr</code>
</h2>
<div class="columns">
<div class="column" style="width:30%;">
<ul>
<li><p><a href="https://r4ds.had.co.nz/transform.html"><em>Tranformation</em> chapter in R4DS</a></p></li>
<li><p><a href="https://github.com/rstudio/cheatsheets/blob/main/data-transformation.pdf">Cheat sheet I</a></p></li>
<li><p><a href="https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">Cheat sheet II</a></p></li>
</ul>
</div><div class="column" style="width:70%;">
<div class="cell">
<iframe src="https://dplyr.tidyverse.org" width="960" height="400px" data-external="1">
</iframe>
</div>
<p><a href="https://dplyr.tidyverse.org">https://dplyr.tidyverse.org</a></p>
</div></div>
</section><section id="section-4" class="slide level2 center"><h2></h2>
<p>Base <i class="fa-brands fa-r-project" aria-label="r-project"></i> provides tools to perform relational algebra operations</p>
<p>But:</p>
<ul>
<li><p>Base <i class="fa-brands fa-r-project" aria-label="r-project"></i> does not provide a consistent API</p></li>
<li><p>The lack of a consistent API makes operation chaining tricky</p></li>
</ul></section><section id="dplyr-verbs" class="slide level2 center"><h2>
<code>dplyr</code> verbs</h2>
<p>Five basic verbs:</p>
<ul>
<li><p>Pick observations/rows by their values (<code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code>) σ(…)</p></li>
<li><p>Pick variables by their names (<code>select()</code>) π(…)</p></li>
<li><p>Reorder the rows (<code>arrange()</code>)</p></li>
<li><p>Create new variables with functions of existing variables (<code>mutate()</code>)</p></li>
<li><p>Collapse many values down to a single summary (<code>summarise()</code>)</p></li>
</ul>
<div class="fragment">
<p>And</p>
<ul>
<li>
<code>group_by()</code> changes the scope of each function from operating on the entire dataset to operating on it group-by-group</li>
</ul>
</div>
</section><section id="tidyverse" class="slide level2 center"><h2>
<i class="fa-solid fa-umbrella-beach" aria-label="umbrella-beach"></i> tidyverse</h2>
<div class="columns">
<div class="column">
<blockquote>
<p>All verbs work similarly:</p>
</blockquote>
<blockquote>
<p>The first argument is a data frame (table).</p>
</blockquote>
<blockquote>
<p>The subsequent arguments describe what to do with the data frame, using the variable/column names (without quotes)</p>
</blockquote>
<blockquote>
<p>The result is a new data frame (table)</p>
</blockquote>
</div><div class="column">
<div class="cell">
<iframe src="https://dplyr.tidyverse.org" width="960" height="400px" data-external="1">
</iframe>
</div>
</div></div>
</section><section id="dplyrselect-as-a-projection-operator-π" class="slide level2 center"><h2>
<code>dplyr::select()</code> as a projection operator (π)</h2>
<p><span class="math inline">\(\pi(R, \underbrace{A_1, \ldots, A_3}_{\text{column names}})\)</span></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a><span class="fu">select</span>(R, A1, A3) <span class="co">#&lt;&lt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>or, equivalently</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a>R <span class="sc">|&gt;</span> <span class="fu">select</span>(A1, A3) <span class="co">#&lt;&lt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><i class="fa-solid fa-hand-point-right" aria-label="hand-point-right"></i> <code>|&gt;</code> is the pipe operator</p>
<p><i class="fa-solid fa-hat-wizard" aria-label="hat-wizard"></i> <code>x |&gt; f(y, z)</code> is translated to <code>f(x, y, z)</code> and then evaluated</p>
</section><section id="dplyrselect" class="slide level2 center"><h2><code>dplyr::select()</code></h2>
<ul>
<li><p>Function <code>select</code> has a variable number of arguments</p></li>
<li><p>Function <code>select</code> has a variable number of arguments</p></li>
<li><p>Function <code>select</code> allows to pick column by names (and much more)</p></li>
<li><p>Note that in the current environment, there are no objects called <code>A1</code>, <code>A3</code></p></li>
<li><p>The consistent API allows to use the pipe operator</p></li>
</ul>
<div class="callout callout-caution callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Caution</strong></p>
</div>
<div class="callout-content">
<p>There is also a <code>select()</code> function in base <code>R</code></p>
</div>
</div>
</div>
</section><section id="toy-tables" class="slide level2 center"><h2>Toy tables</h2>
<div class="columns">
<div class="column">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a>spam <span class="ot">&lt;-</span> <span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb10-2"><a></a></span>
<span id="cb10-3"><a></a>R <span class="ot">&lt;-</span>  <span class="fu">tibble</span>(<span class="at">A1=</span><span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">2</span>),</span>
<span id="cb10-4"><a></a>             <span class="at">A2=</span><span class="fu">sample</span>(letters, <span class="dv">5</span>),</span>
<span id="cb10-5"><a></a>             <span class="at">A3=</span><span class="fu">seq</span>(<span class="at">from=</span><span class="fu">date</span>(<span class="st">"2021-10-21"</span>),</span>
<span id="cb10-6"><a></a>                    <span class="at">to=</span><span class="fu">date</span>(<span class="st">"2021-11-20"</span>),</span>
<span id="cb10-7"><a></a>                    <span class="at">by=</span><span class="dv">7</span>),</span>
<span id="cb10-8"><a></a>             <span class="at">D=</span><span class="fu">sample</span>(letters, <span class="dv">5</span>))</span>
<span id="cb10-9"><a></a></span>
<span id="cb10-10"><a></a>S <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">E=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">9</span>, <span class="dv">10</span>),</span>
<span id="cb10-11"><a></a>            <span class="at">F=</span><span class="fu">sample</span>(letters, <span class="dv">5</span>),</span>
<span id="cb10-12"><a></a>            <span class="at">G=</span><span class="fu">seq</span>(<span class="at">from=</span><span class="fu">date</span>(<span class="st">"2021-10-21"</span>),</span>
<span id="cb10-13"><a></a>                   <span class="at">to=</span><span class="fu">date</span>(<span class="st">"2021-10-21"</span>)<span class="sc">+</span><span class="dv">4</span>, <span class="at">by=</span><span class="dv">1</span>),</span>
<span id="cb10-14"><a></a>            <span class="at">D=</span><span class="fu">sample</span>(letters,<span class="dv">5</span>)</span>
<span id="cb10-15"><a></a>          )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<caption>R</caption>
<thead><tr class="header">
<th style="text-align: right;">A1</th>
<th style="text-align: left;">A2</th>
<th style="text-align: left;">A3</th>
<th style="text-align: left;">D</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">q</td>
<td style="text-align: left;">2021-10-21</td>
<td style="text-align: left;">r</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">e</td>
<td style="text-align: left;">2021-10-28</td>
<td style="text-align: left;">q</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: left;">a</td>
<td style="text-align: left;">2021-11-04</td>
<td style="text-align: left;">o</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: left;">j</td>
<td style="text-align: left;">2021-11-11</td>
<td style="text-align: left;">g</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: left;">d</td>
<td style="text-align: left;">2021-11-18</td>
<td style="text-align: left;">d</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top">
<caption>S</caption>
<thead><tr class="header">
<th style="text-align: right;">E</th>
<th style="text-align: left;">F</th>
<th style="text-align: left;">G</th>
<th style="text-align: left;">D</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">y</td>
<td style="text-align: left;">2021-10-21</td>
<td style="text-align: left;">o</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">e</td>
<td style="text-align: left;">2021-10-22</td>
<td style="text-align: left;">c</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: left;">n</td>
<td style="text-align: left;">2021-10-23</td>
<td style="text-align: left;">i</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: left;">t</td>
<td style="text-align: left;">2021-10-24</td>
<td style="text-align: left;">d</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: left;">r</td>
<td style="text-align: left;">2021-10-25</td>
<td style="text-align: left;">e</td>
</tr>
</tbody>
</table>
</div>
</div>
</div></div>
</section><section id="projecting-toy-tables" class="slide level2 center"><h2>Projecting toy tables</h2>
<div class="columns">
<div class="column">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a>R <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(A2,D) <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">caption=</span><span class="st">"Projecting R"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top">
<caption>Projecting R</caption>
<thead><tr class="header">
<th style="text-align: left;">A2</th>
<th style="text-align: left;">D</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">q</td>
<td style="text-align: left;">r</td>
</tr>
<tr class="even">
<td style="text-align: left;">e</td>
<td style="text-align: left;">q</td>
</tr>
<tr class="odd">
<td style="text-align: left;">a</td>
<td style="text-align: left;">o</td>
</tr>
<tr class="even">
<td style="text-align: left;">j</td>
<td style="text-align: left;">g</td>
</tr>
<tr class="odd">
<td style="text-align: left;">d</td>
<td style="text-align: left;">d</td>
</tr>
</tbody>
</table>
</div>
</div>
</div><div class="column">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a>R <span class="sc">|&gt;</span> </span>
<span id="cb12-2"><a></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span> <span class="fu">where</span>(is.character)) <span class="sc">|&gt;</span> </span>
<span id="cb12-3"><a></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">caption=</span><span class="st">"Projecting R, all but character columns"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<table class="caption-top">
<caption>Projecting R, all but character columns</caption>
<thead><tr class="header">
<th style="text-align: right;">A1</th>
<th style="text-align: left;">A3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">2021-10-21</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">2021-10-28</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: left;">2021-11-04</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: left;">2021-11-11</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: left;">2021-11-18</td>
</tr>
</tbody>
</table>
</div>
</div>
</div></div>
</section><section id="projecting-flights-on-origin-and-dest" class="slide level2 center"><h2>Projecting <code>flights</code> on <code>origin</code> and <code>dest</code>
</h2>
<div class="cell columns column-output-location">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a>flights <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a></a>  <span class="fu">select</span>(origin, dest) <span class="sc">|&gt;</span>  <span class="co">#&lt;&lt;</span></span>
<span id="cb13-3"><a></a>  <span class="fu">head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  origin dest 
  &lt;chr&gt;  &lt;chr&gt;
1 EWR    IAH  
2 LGA    IAH  
3 JFK    MIA  
4 JFK    BQN  
5 LGA    ATL  
6 EWR    ORD  </code></pre>
</div>
</div></div>
<p>A more readable equivalent of</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a><span class="fu">head</span>(<span class="fu">select</span>(flights, origin, dest), <span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>or</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb16-1"><a></a><span class="kw">SELECT</span> </span>
<span id="cb16-2"><a></a>  origin, dest</span>
<span id="cb16-3"><a></a><span class="kw">FROM</span> </span>
<span id="cb16-4"><a></a>  flights</span>
<span id="cb16-5"><a></a><span class="kw">LIMIT</span> <span class="dv">6</span>;</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section><section id="sigmar-textcondition" class="slide level2 center"><h2><span class="math inline">\(\sigma(R, \text{condition})\)</span></h2>
<ul>
<li><p>A selection/filtering operation is defined by a condition that can be checked on the rows of tables with convenient schema</p></li>
<li><p><span class="math inline">\(\sigma(R, \text{condition})\)</span> returns a table with the same schema as <span class="math inline">\(R\)</span></p></li>
<li><p>The resulting table contains the rows/tuples of <span class="math inline">\(R\)</span> that satisfy <span class="math inline">\(\text{condition}\)</span></p></li>
<li><p><span class="math inline">\(\sigma(R, \text{FALSE})\)</span> returns an empty table with the same schema as <span class="math inline">\(R\)</span></p></li>
</ul></section><section id="chaining-filtering-and-projecting" class="slide level2 center"><h2>Chaining filtering and projecting</h2>
<div class="cell columns column-output-location">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a>start <span class="ot">&lt;-</span> <span class="fu">date</span>(<span class="st">"2021-10-27"</span>)</span>
<span id="cb17-2"><a></a>end <span class="ot">&lt;-</span> start <span class="sc">+</span> <span class="dv">21</span></span>
<span id="cb17-3"><a></a></span>
<span id="cb17-4"><a></a>R <span class="sc">|&gt;</span></span>
<span id="cb17-5"><a></a><span class="co">#  filter(A2 &gt; "n") |&gt;  #&lt;&lt;</span></span>
<span id="cb17-6"><a></a>  <span class="fu">filter</span>(<span class="fu">between</span>(A3, start, end)) <span class="sc">|&gt;</span></span>
<span id="cb17-7"><a></a>  <span class="fu">select</span>(A1, A3) <span class="co">#&lt;&lt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
     A1 A3        
  &lt;dbl&gt; &lt;date&gt;    
1     4 2021-10-28
2     6 2021-11-04
3     8 2021-11-11</code></pre>
</div>
</div></div>

<aside><div>
<p>Filtering dropped one row</p>
<p>Projecting dropped two columns</p>
</div></aside></section><section id="selecting-flights-based-on-origin-and-dest" class="slide level2 center"><h2>Selecting <code>flights</code> based on <code>origin</code> and <code>dest</code>
</h2>
<p>and then projecting on <code>dest, time_hour, carrier</code></p>
<div class="cell columns column-output-location">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a></a>flights <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a></a>  <span class="fu">filter</span>(dest <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'ATL'</span>, <span class="st">'LAX'</span>), <span class="co">#&lt;&lt;</span></span>
<span id="cb19-3"><a></a>         origin <span class="sc">==</span> <span class="st">'JFK'</span>) <span class="sc">|&gt;</span></span>
<span id="cb19-4"><a></a>  <span class="fu">select</span>(dest, time_hour, carrier) <span class="sc">|&gt;</span> <span class="co">#&lt;&lt;</span></span>
<span id="cb19-5"><a></a>  <span class="fu">head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  dest  time_hour           carrier
  &lt;chr&gt; &lt;dttm&gt;              &lt;chr&gt;  
1 LAX   2013-01-01 06:00:00 UA     
2 ATL   2013-01-01 06:00:00 DL     
3 LAX   2013-01-01 07:00:00 VX     
4 LAX   2013-01-01 07:00:00 B6     
5 LAX   2013-01-01 07:00:00 AA     
6 ATL   2013-01-01 08:00:00 DL     </code></pre>
</div>
</div></div>
<p>In SQL (<i class="fa-solid fa-database" aria-label="database"></i> parlance:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb21-1"><a></a><span class="kw">SELECT</span> </span>
<span id="cb21-2"><a></a>  dest, time_hour, carrier</span>
<span id="cb21-3"><a></a><span class="kw">FROM</span> </span>
<span id="cb21-4"><a></a>  flights</span>
<span id="cb21-5"><a></a><span class="kw">WHERE</span> </span>
<span id="cb21-6"><a></a>  dest <span class="kw">IN</span> (<span class="st">'ATL'</span>, <span class="st">'LAX'</span>) <span class="kw">AND</span></span>
<span id="cb21-7"><a></a>  origin <span class="op">=</span> <span class="st">'JFK'</span></span>
<span id="cb21-8"><a></a><span class="kw">LIMIT</span> <span class="dv">6</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section><section id="logical-operations" class="slide level2 center"><h2>Logical operations</h2>
<ul>
<li><p><code>filter(R, condition_1, condition_2)</code> is meant to return the rows of <code>R</code> that satisfy <code>condition_1</code> <strong>and</strong> <code>condition_2</code></p></li>
<li><p><code>filter(R, condition_1 &amp; condition_2)</code> is an equivalent formulation</p></li>
<li><p><code>filter(R, condition_1 | condition_2)</code> is meant to return the rows of <code>R</code> that satisfy <code>condition_1</code> <strong>or</strong> <code>condition_2</code> (possibly both)</p></li>
<li><p><code>filter(R, xor(condition_1,condition_2))</code> is meant to return the rows of <code>R</code> that satisfy <strong>either</strong> <code>condition_1</code> <strong>or</strong> <code>condition_2</code> (just one of them)</p></li>
<li><p><code>filter(R, ! condition_1)</code> is meant to return the rows of <code>R</code> that <strong>do not</strong> satisfy <code>condition_1</code></p></li>
</ul>
<!-- ## Overview of set and boolean operations


![](/images/transform-logical.png)
 --></section><section id="missing-values" class="slide level2 center"><h2>
<i class="fa-solid fa-skull-crossbones" aria-label="skull-crossbones"></i> Missing values!</h2>
<p>Numerical column <code>dep_time</code> contains many <code>NA's</code> (missing values)</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a></a><span class="co"># flights |&gt; pull(dep_time) |&gt; summary()</span></span>
<span id="cb22-2"><a></a><span class="fu">summary</span>(flights<span class="sc">$</span>dep_time)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
      1     907    1401    1349    1744    2400    8255 </code></pre>
</div>
</div>
<p><i class="fa-solid fa-hand-point-right" aria-label="hand-point-right"></i> Missing values (<code>NA</code> and variants) should be handled with care</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a></a><span class="cn">NA</span> <span class="sc">&amp;</span> <span class="cn">TRUE</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>[1] NA</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a></a><span class="cn">NA</span> <span class="sc">|</span> <span class="cn">TRUE</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>[1] TRUE</p>
</section><section id="truth-tables-for-three-valued-logic" class="slide level2 smaller center"><h2>Truth tables for three-valued logic</h2>
<div class="columns">
<div class="column">
<p><i class="fa-solid fa-exclamation-triangle" aria-label="exclamation-triangle"></i> <i class="fa-brands fa-r-project" aria-label="r-project"></i> uses <em>three-valued logic</em></p>
<p><i class="fa-solid fa-hand-point-right" aria-label="hand-point-right"></i> Generate complete truth tables for <code>and, or, xor</code></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a>v <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">NA</span>) <span class="co"># truth values</span></span>
<span id="cb26-2"><a></a></span>
<span id="cb26-3"><a></a>list_tt <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="fu">c</span>(<span class="st">`</span><span class="at">&amp;</span><span class="st">`</span>, <span class="st">`</span><span class="at">|</span><span class="st">`</span>, xor),  <span class="co">#&lt;&lt;</span></span>
<span id="cb26-4"><a></a>               <span class="sc">~</span> <span class="fu">outer</span>(v, v, .x)) <span class="co">#&lt;&lt;</span></span>
<span id="cb26-5"><a></a></span>
<span id="cb26-6"><a></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(list_tt)){</span>
<span id="cb26-7"><a></a>  <span class="fu">colnames</span>(list_tt[[i]]) <span class="ot">&lt;-</span> v</span>
<span id="cb26-8"><a></a>  <span class="fu">rownames</span>(list_tt[[i]]) <span class="ot">&lt;-</span> v</span>
<span id="cb26-9"><a></a>}</span>
<span id="cb26-10"><a></a></span>
<span id="cb26-11"><a></a><span class="fu">names</span>(list_tt) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'&amp; AND'</span>,</span>
<span id="cb26-12"><a></a>                    <span class="st">'OR'</span>,</span>
<span id="cb26-13"><a></a>                    <span class="st">'XOR'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column" style="width:10%;">

</div><div class="column" style="width:40%;">
<table class=" lightable-minimal" style="font-family: &quot;Trebuchet MS&quot;, verdana, sans-serif; width: auto !important; ">
<caption>
&amp; AND
</caption>
<thead><tr>
<th style="text-align:left;font-weight: bold;background-color: lightgray !important;">
</th>
<th style="text-align:left;font-weight: bold;background-color: lightgray !important;">
TRUE
</th>
<th style="text-align:left;font-weight: bold;background-color: lightgray !important;">
FALSE
</th>
<th style="text-align:left;font-weight: bold;background-color: lightgray !important;">
NA
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;background-color: lightgray !important;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;background-color: lightgray !important;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;background-color: lightgray !important;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table>
<p><br></p>
<!-- -->
<table class=" lightable-minimal" style="font-family: &quot;Trebuchet MS&quot;, verdana, sans-serif; width: auto !important; ">
<caption>
OR
</caption>
<thead><tr>
<th style="text-align:left;font-weight: bold;background-color: lightgray !important;">
</th>
<th style="text-align:left;font-weight: bold;background-color: lightgray !important;">
TRUE
</th>
<th style="text-align:left;font-weight: bold;background-color: lightgray !important;">
FALSE
</th>
<th style="text-align:left;font-weight: bold;background-color: lightgray !important;">
NA
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;background-color: lightgray !important;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;background-color: lightgray !important;">
FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;background-color: lightgray !important;">
NA
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table>
<p><br></p>
<!-- -->
<table class=" lightable-minimal" style="font-family: &quot;Trebuchet MS&quot;, verdana, sans-serif; width: auto !important; ">
<caption>
XOR
</caption>
<thead><tr>
<th style="text-align:left;font-weight: bold;background-color: lightgray !important;">
</th>
<th style="text-align:left;font-weight: bold;background-color: lightgray !important;">
TRUE
</th>
<th style="text-align:left;font-weight: bold;background-color: lightgray !important;">
FALSE
</th>
<th style="text-align:left;font-weight: bold;background-color: lightgray !important;">
NA
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;font-weight: bold;background-color: lightgray !important;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;background-color: lightgray !important;">
FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;background-color: lightgray !important;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
</tbody>
</table>
<p><br></p>
<!-- -->
</div></div>
</section><section id="slice-choosing-rows-based-on-location" class="slide level2 center"><h2>
<code>slice()</code>: choosing rows based on location</h2>
<div class="columns">
<div class="column">
<p>In base <i class="fa-brands fa-r-project" aria-label="r-project"></i> dataframe cells can be addressed by indices</p>
<p><code>flights[5000:5010,seq(1, 19, by=5)]</code> returns rows <code>5000:5010</code> and columns <code>1, 6, 11</code> from dataframe <code>flights</code></p>
<p>This can be done in a (verbose) <code>dplyr</code> way using <code>slice()</code> and <code>select()</code></p>
</div><div class="column">
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a></a>flights <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a></a>  <span class="fu">slice</span>(<span class="dv">5001</span><span class="sc">:</span><span class="dv">5005</span>) <span class="sc">|&gt;</span>  <span class="co">#&lt;&lt;</span></span>
<span id="cb27-3"><a></a>  <span class="fu">select</span>(<span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">19</span>, <span class="at">by=</span><span class="dv">5</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
   year dep_delay flight distance
  &lt;int&gt;     &lt;dbl&gt;  &lt;int&gt;    &lt;dbl&gt;
1  2013         3   4437      602
2  2013        43   1016      187
3  2013        -2   2190     1089
4  2013        -1     91     2576
5  2013         5   2131      502</code></pre>
</div>
</div>
</div></div>
<p><i class="fa-solid fa-hand-point-right" aria-label="hand-point-right"></i> combined with aggregation (<code>group_by()</code>) variants of <code>slice_</code> may be used to perform <em>windowing</em> operations</p>
<p><i class="fa-solid fa-hand-point-right" aria-label="hand-point-right"></i> Useful variant <code>slice_sample()</code></p>
</section></section><section><section id="joins-multi-table-queries" class="title-slide slide level1 center" data-background-color="#1c191c"><h1>Joins : multi-table queries</h1>

</section><section id="section-5" class="slide level2 center"><h2></h2>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p><span class="math inline">\(\bowtie(R,S, {\text{condition}})\)</span></p>
<p>stands for</p>
<blockquote>
<p>join rows/tuples of <span class="math inline">\(R\)</span> and rows/tuples of <span class="math inline">\(S\)</span> that satisfy <span class="math inline">\(\text{condition}\)</span></p>
</blockquote>
</div>
</div>
</div>
</section><section id="nycflights-tables" class="slide level2 center"><h2>
<code>nycflights</code> tables</h2>
<div class="columns">
<div class="column">
<p>The <code>nycflights13</code> package offers five related tables:</p>
<ul>
<li>
<em>Fact</em> tables:
<ul>
<li><code>flights</code></li>
<li>
<code>weather</code> (hourly weather conditions at different locations)</li>
</ul>
</li>
<li>
<em>Dimension</em> tables:
<ul>
<li>
<code>airports</code> (airports full names, location, …)</li>
<li>
<code>planes</code> (model, manufacturer, year, …)</li>
<li>
<code>airlines</code> (full names)</li>
</ul>
</li>
</ul>
<p>This is an instance of a <a href="https://en.wikipedia.org/wiki/Star_schema">Star Schema</a></p>
</div><div class="column">
<p><img data-src="../../images/schema-nycflights.png"></p>
</div></div>
</section><section id="about-star-schemas" class="slide level2 center"><h2>About <em>Star schemas</em>
</h2>
<ul>
<li><p>Fact tables record measurements for a specific event</p></li>
<li><p>Fact tables generally consist of numeric values, and foreign keys to dimensional data where descriptive information is kept</p></li>
<li><p>Dimension tables record informations about entities involved in events recorded in Fact tables</p></li>
</ul>

<aside><div>
<p>From <a href="https://en.wikipedia.org/wiki/Star_schema">Wikipedia</a>]</p>
</div></aside></section><section id="weather-conditions" class="slide level2 center"><h2>
<i class="fa-solid fa-wind" aria-label="wind"></i> weather conditions</h2>
<div class="cell columns column-output-location">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a></a>weather <span class="sc">|&gt;</span></span>
<span id="cb29-2"><a></a>  <span class="fu">glimpse</span>(<span class="at">width =</span> <span class="dv">50</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 26,115
Columns: 15
$ origin     &lt;chr&gt; "EWR", "EWR", "EWR", "EWR", "…
$ year       &lt;int&gt; 2013, 2013, 2013, 2013, 2013,…
$ month      &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ day        &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…
$ hour       &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10…
$ temp       &lt;dbl&gt; 39.02, 39.02, 39.02, 39.92, 3…
$ dewp       &lt;dbl&gt; 26.06, 26.96, 28.04, 28.04, 2…
$ humid      &lt;dbl&gt; 59.37, 61.63, 64.43, 62.21, 6…
$ wind_dir   &lt;dbl&gt; 270, 250, 240, 250, 260, 240,…
$ wind_speed &lt;dbl&gt; 10.35702, 8.05546, 11.50780, …
$ wind_gust  &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, N…
$ precip     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ pressure   &lt;dbl&gt; 1012.0, 1012.3, 1012.5, 1012.…
$ visib      &lt;dbl&gt; 10, 10, 10, 10, 10, 10, 10, 1…
$ time_hour  &lt;dttm&gt; 2013-01-01 01:00:00, 2013-01…</code></pre>
</div>
</div></div>
</section><section id="connecting-flights-and-weather" class="slide level2 center"><h2>Connecting <code>flights</code> and <code>weather</code>
</h2>
<p>We want to complement information in <code>flights</code> using data <code>weather</code></p>
<p>Motivation: we would like to relate delays (<code>arr_delay</code>) and weather conditions</p>
<ul>
<li><p>can we explain (justify) delays using weather data?</p></li>
<li><p>can we predict delays using weather data?</p></li>
</ul></section><section id="section-6" class="slide level2 center"><h2>
<i class="fa-solid fa-plane-departure" aria-label="plane-departure"></i> ⋈ <i class="fa-solid fa-wind" aria-label="wind"></i>
</h2>
<p>For each flight (row in <code>flights</code>)</p>
<ul>
<li><p><code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code> (computed from <code>time_hour</code>) indicate the approaximate time of departure</p></li>
<li><p><code>origin</code> indicates the airport where the plane takes off</p></li>
</ul>
<p>Each row of <code>weather</code> contains corresponding information</p>
<p><i class="fa-solid fa-hand-point-right" aria-label="hand-point-right"></i> for each row of <code>flights</code> we look for rows of <code>weather</code> with matching values in <code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code> and <code>origin</code></p>
<p><i class="fa-solid fa-hand-point-right" aria-label="hand-point-right"></i> NATURAL INNER JOIN between the tables</p>
</section><section id="inner_join-natural-join" class="slide level2 center"><h2>
<code>inner_join</code>: natural join</h2>
<div class="cell columns column-output-location">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a></a>f_w <span class="ot">&lt;-</span> flights <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a></a>  <span class="fu">inner_join</span>(weather) <span class="co">#&lt;&lt;</span></span>
<span id="cb31-3"><a></a></span>
<span id="cb31-4"><a></a>f_w <span class="sc">|&gt;</span> </span>
<span id="cb31-5"><a></a>  <span class="fu">select</span>(<span class="fu">seq</span>(<span class="dv">1</span>, </span>
<span id="cb31-6"><a></a>             <span class="fu">ncol</span>(f_w),</span>
<span id="cb31-7"><a></a>             <span class="at">by=</span><span class="dv">2</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb31-8"><a></a>  <span class="fu">glimpse</span>(<span class="at">width=</span><span class="dv">50</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 335,220
Columns: 14
$ year           &lt;int&gt; 2013, 2013, 2013, 2013, 2…
$ day            &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ sched_dep_time &lt;int&gt; 515, 529, 540, 545, 600, …
$ arr_time       &lt;int&gt; 830, 850, 923, 1004, 812,…
$ arr_delay      &lt;dbl&gt; 11, 20, 33, -18, -25, 12,…
$ flight         &lt;int&gt; 1545, 1714, 1141, 725, 46…
$ origin         &lt;chr&gt; "EWR", "LGA", "JFK", "JFK…
$ air_time       &lt;dbl&gt; 227, 227, 160, 183, 116, …
$ hour           &lt;dbl&gt; 5, 5, 5, 5, 6, 5, 6, 6, 6…
$ time_hour      &lt;dttm&gt; 2013-01-01 05:00:00, 201…
$ dewp           &lt;dbl&gt; 28.04, 24.98, 26.96, 26.9…
$ wind_dir       &lt;dbl&gt; 260, 250, 260, 260, 260, …
$ wind_gust      &lt;dbl&gt; NA, 21.86482, NA, NA, 23.…
$ pressure       &lt;dbl&gt; 1011.9, 1011.4, 1012.1, 1…</code></pre>
</div>
</div></div>
</section><section id="join-schema" class="slide level2 center"><h2>Join schema</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 335,220
Columns: 28
$ year           &lt;int&gt; 2013, 2013, 2013, 2013, 2…
$ month          &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ day            &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1…
$ dep_time       &lt;int&gt; 517, 533, 542, 544, 554, …
$ sched_dep_time &lt;int&gt; 515, 529, 540, 545, 600, …
$ dep_delay      &lt;dbl&gt; 2, 4, 2, -1, -6, -4, -5, …
$ arr_time       &lt;int&gt; 830, 850, 923, 1004, 812,…
$ sched_arr_time &lt;int&gt; 819, 830, 850, 1022, 837,…
$ arr_delay      &lt;dbl&gt; 11, 20, 33, -18, -25, 12,…
$ carrier        &lt;chr&gt; "UA", "UA", "AA", "B6", "…
$ flight         &lt;int&gt; 1545, 1714, 1141, 725, 46…
$ tailnum        &lt;chr&gt; "N14228", "N24211", "N619…
$ origin         &lt;chr&gt; "EWR", "LGA", "JFK", "JFK…
$ dest           &lt;chr&gt; "IAH", "IAH", "MIA", "BQN…
$ air_time       &lt;dbl&gt; 227, 227, 160, 183, 116, …
$ distance       &lt;dbl&gt; 1400, 1416, 1089, 1576, 7…
$ hour           &lt;dbl&gt; 5, 5, 5, 5, 6, 5, 6, 6, 6…
$ minute         &lt;dbl&gt; 15, 29, 40, 45, 0, 58, 0,…
$ time_hour      &lt;dttm&gt; 2013-01-01 05:00:00, 201…
$ temp           &lt;dbl&gt; 39.02, 39.92, 39.02, 39.0…
$ dewp           &lt;dbl&gt; 28.04, 24.98, 26.96, 26.9…
$ humid          &lt;dbl&gt; 64.43, 54.81, 61.63, 61.6…
$ wind_dir       &lt;dbl&gt; 260, 250, 260, 260, 260, …
$ wind_speed     &lt;dbl&gt; 12.65858, 14.96014, 14.96…
$ wind_gust      &lt;dbl&gt; NA, 21.86482, NA, NA, 23.…
$ precip         &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0…
$ pressure       &lt;dbl&gt; 1011.9, 1011.4, 1012.1, 1…
$ visib          &lt;dbl&gt; 10, 10, 10, 10, 10, 10, 1…</code></pre>
</div>
</div>
</section><section id="section-7" class="slide level2 center"><h2></h2>
<p>The schema of the result is the union of the schemas of the operands</p>
<p>A tuple from <code>flights</code> matches a tuple from <code>weather</code> if the tuple have the same values in the common columns:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] "year"           "month"          "day"            "dep_time"      
 [5] "sched_dep_time" "dep_delay"      "arr_time"       "sched_arr_time"
 [9] "arr_delay"      "carrier"        "flight"         "tailnum"       
[13] "origin"         "dest"           "air_time"       "distance"      
[17] "hour"           "minute"         "time_hour"      "temp"          
[21] "dewp"           "humid"          "wind_dir"       "wind_speed"    
[25] "wind_gust"      "precip"         "pressure"       "visib"         </code></pre>
</div>
</div>
</section><section id="which-columns-are-used-when-joining-tables-r-and-s" class="slide level2 center"><h2>Which columns are used when joining tables <span class="math inline">\(R\)</span> and <span class="math inline">\(S\)</span>?</h2>
<ul>
<li><p><em>default behavior</em> of <code>inner_join</code>: all columns shared by <span class="math inline">\(R\)</span> and <span class="math inline">\(S\)</span>. Common columns have the same name in both schema. They are expected to have the same class</p></li>
<li><p><em>manual definition</em>: in many settings, we want to overrule the default behavior. We specify manually which column from <span class="math inline">\(R\)</span> should match which column from <span class="math inline">\(S\)</span></p></li>
</ul></section><section id="natural-join-of-flights-and-weather" class="slide level2 center"><h2>Natural join of <code>flights</code> and <code>weather</code>:</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a></a>common_names <span class="ot">&lt;-</span> base<span class="sc">::</span><span class="fu">intersect</span>(<span class="fu">names</span>(weather),</span>
<span id="cb35-2"><a></a>                                <span class="fu">names</span>(flights))</span>
<span id="cb35-3"><a></a></span>
<span id="cb35-4"><a></a><span class="fu">setequal</span>(</span>
<span id="cb35-5"><a></a>  <span class="fu">inner_join</span>(flights, weather),</span>
<span id="cb35-6"><a></a>  <span class="fu">inner_join</span>(flights,</span>
<span id="cb35-7"><a></a>             weather,</span>
<span id="cb35-8"><a></a>             <span class="at">by=</span>common_names)</span>
<span id="cb35-9"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section><section id="are-you-surprised-by-the-next-chunk" class="slide level2 center"><h2>
<i class="fa-solid fa-brain" aria-label="brain"></i> Are you surprised by the next chunk?</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a></a>dtu  <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(flights,</span>
<span id="cb37-2"><a></a>           weather,</span>
<span id="cb37-3"><a></a>           <span class="at">by=</span><span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"month"</span>, <span class="st">"day"</span>, <span class="st">"origin"</span>, <span class="st">"hour"</span>))</span>
<span id="cb37-4"><a></a></span>
<span id="cb37-5"><a></a>dtv <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(flights,</span>
<span id="cb37-6"><a></a>           weather,</span>
<span id="cb37-7"><a></a>           <span class="at">by=</span><span class="fu">c</span>(<span class="st">"origin"</span>, <span class="st">"time_hour"</span>))</span>
<span id="cb37-8"><a></a></span>
<span id="cb37-9"><a></a><span class="co"># setequal(dtu, dtv)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Recall that columns <code>year</code>, <code>month</code> <code>day</code> <code>hour</code> can be computed from <code>time_hour</code></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a></a>flights <span class="sc">|&gt;</span></span>
<span id="cb38-2"><a></a>  <span class="fu">filter</span>(year<span class="sc">!=</span><span class="fu">year</span>(time_hour) <span class="sc">|</span></span>
<span id="cb38-3"><a></a>         month<span class="sc">!=</span><span class="fu">month</span>(time_hour) <span class="sc">|</span></span>
<span id="cb38-4"><a></a>         day<span class="sc">!=</span><span class="fu">day</span>(time_hour) <span class="sc">|</span></span>
<span id="cb38-5"><a></a>         hour<span class="sc">!=</span><span class="fu">hour</span>(time_hour)) <span class="sc">|&gt;</span></span>
<span id="cb38-6"><a></a>  <span class="fu">nrow</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
</section><section id="the-two-results-do-not-have-the-same-schema" class="slide level2 center"><h2>The two results do not have the same schema!</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a></a><span class="fu">setdiff</span>(<span class="fu">colnames</span>(dtv), <span class="fu">colnames</span>(dtu))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "year.x"    "month.x"   "day.x"     "hour.x"    "time_hour" "year.y"   
[7] "month.y"   "day.y"     "hour.y"   </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a></a><span class="fu">setdiff</span>(<span class="fu">colnames</span>(dtu), <span class="fu">colnames</span>(dtv))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "year"        "month"       "day"         "hour"        "time_hour.x"
[6] "time_hour.y"</code></pre>
</div>
</div>
</section><section id="fixing" class="slide level2 center"><h2>Fixing</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a></a>dtu  <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(flights,</span>
<span id="cb44-2"><a></a>           weather,</span>
<span id="cb44-3"><a></a>           <span class="at">by=</span><span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"month"</span>, <span class="st">"day"</span>, <span class="st">"origin"</span>, <span class="st">"hour"</span>),</span>
<span id="cb44-4"><a></a>           <span class="at">suffix=</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">".y"</span>)) <span class="sc">|&gt;</span>  <span class="co">#&lt;&lt;</span></span>
<span id="cb44-5"><a></a>           <span class="fu">select</span>(<span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">".y"</span>))  <span class="co">#&lt;&lt;</span></span>
<span id="cb44-6"><a></a></span>
<span id="cb44-7"><a></a>dtv <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(flights,</span>
<span id="cb44-8"><a></a>           weather,</span>
<span id="cb44-9"><a></a>           <span class="at">by=</span><span class="fu">c</span>(<span class="st">"origin"</span>, <span class="st">"time_hour"</span>),</span>
<span id="cb44-10"><a></a>           <span class="at">suffix=</span> <span class="fu">c</span>(<span class="st">""</span>, <span class="st">".y"</span>)) <span class="sc">|&gt;</span>  <span class="co">#&lt;&lt;</span></span>
<span id="cb44-11"><a></a>           <span class="fu">select</span>(<span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">".y"</span>))  <span class="co">#&lt;&lt;</span></span>
<span id="cb44-12"><a></a></span>
<span id="cb44-13"><a></a><span class="fu">setequal</span>(dtu, dtv)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section><section id="about-inner_join" class="slide level2 center"><h2>About <code>inner_join</code>
</h2>
<div class="columns">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb46"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a></a><span class="fu">inner_join</span>(</span>
<span id="cb46-2"><a></a>  x, y,</span>
<span id="cb46-3"><a></a>  <span class="at">by =</span> <span class="cn">NULL</span>,      <span class="co">#&lt;&lt;</span></span>
<span id="cb46-4"><a></a>  <span class="at">copy =</span> <span class="cn">FALSE</span>,</span>
<span id="cb46-5"><a></a>  <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">".x"</span>, <span class="st">".y"</span>), <span class="co">#&lt;&lt;</span></span>
<span id="cb46-6"><a></a>  ...,</span>
<span id="cb46-7"><a></a>  <span class="at">keep =</span> <span class="cn">FALSE</span>,  <span class="co">#&lt;&lt;</span></span>
<span id="cb46-8"><a></a>  <span class="at">na_matches =</span> <span class="st">"na"</span>)  <span class="co">#&lt;&lt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column">
<ul>
<li>
<p><code>by</code>:</p>
<ul>
<li>
<code>by=c("A1", "A3", "A7")</code> row <code>r</code> from <code>R</code> and <code>s</code> from <code>S</code> match if <code>r.A1 == s.A1</code>, <code>r.A3 == s.A3</code>, <code>r.A7 == s.A7</code>
</li>
<li>
<code>by=c("A1"="B", "A3"="C", "A7"="D")</code> row <code>r</code> from <code>R</code> and <code>s</code> from <code>S</code> match if <code>r.A1 == s.B</code>, <code>r.A3 == s.C</code>, <code>r.A7 == s.D</code>
</li>
</ul>
</li>
<li><p><code>suffix</code>: If there are non-joined duplicate variables in <code>x</code> and <code>y</code>, these suffixes will be added to the output to disambiguate them.</p></li>
<li><p><code>keep</code>: Should the join keys from <em>both</em> <code>x</code> and <code>y</code> be preserved in the output?</p></li>
<li><p><code>na_matches</code>: Should NA and NaN values match one another?</p></li>
</ul>

</div></div>
<aside><div>
<p>From online documentation</p>
</div></aside></section><section id="join-flavors" class="slide level2 center"><h2>Join flavors</h2>
<p>Different flavors of <code>join</code> can be used to join one table to columns from another, matching values with the rows that they correspond to</p>
<p>Each join retains a different combination of values from the tables</p>
<div class="fragment">
<ul>
<li><p><code>left_join(x, y, by = NULL, suffix = c(".x", ".y"), ...)</code> Join matching values from <code>y</code> to <code>x</code>. Retain all rows of <code>x</code> padding missing values from <code>y</code> by <code>NA</code></p></li>
<li><p><code>semi_join</code> …</p></li>
<li><p><code>anti_join</code> …</p></li>
</ul>
</div>
</section><section id="toy-examples-inner_join" class="slide level2 smaller center"><h2>Toy examples : <code>inner_join</code>
</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<caption>R</caption>
<thead><tr class="header">
<th style="text-align: right;">A1</th>
<th style="text-align: left;">A2</th>
<th style="text-align: left;">A3</th>
<th style="text-align: left;">D</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">q</td>
<td style="text-align: left;">2021-10-21</td>
<td style="text-align: left;">r</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">e</td>
<td style="text-align: left;">2021-10-28</td>
<td style="text-align: left;">q</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: left;">a</td>
<td style="text-align: left;">2021-11-04</td>
<td style="text-align: left;">o</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: left;">j</td>
<td style="text-align: left;">2021-11-11</td>
<td style="text-align: left;">g</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: left;">d</td>
<td style="text-align: left;">2021-11-18</td>
<td style="text-align: left;">d</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top">
<caption>S</caption>
<thead><tr class="header">
<th style="text-align: right;">E</th>
<th style="text-align: left;">F</th>
<th style="text-align: left;">G</th>
<th style="text-align: left;">D</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">y</td>
<td style="text-align: left;">2021-10-21</td>
<td style="text-align: left;">o</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">e</td>
<td style="text-align: left;">2021-10-22</td>
<td style="text-align: left;">c</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: left;">n</td>
<td style="text-align: left;">2021-10-23</td>
<td style="text-align: left;">i</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: left;">t</td>
<td style="text-align: left;">2021-10-24</td>
<td style="text-align: left;">d</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: left;">r</td>
<td style="text-align: left;">2021-10-25</td>
<td style="text-align: left;">e</td>
</tr>
</tbody>
</table>
</div>
</div>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<caption>inner_join(S, R, by=c(“E”=“A1”))</caption>
<thead><tr class="header">
<th style="text-align: right;">E</th>
<th style="text-align: left;">F</th>
<th style="text-align: left;">G</th>
<th style="text-align: left;">D.x</th>
<th style="text-align: left;">A2</th>
<th style="text-align: left;">A3</th>
<th style="text-align: left;">D.y</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">e</td>
<td style="text-align: left;">2021-10-22</td>
<td style="text-align: left;">c</td>
<td style="text-align: left;">e</td>
<td style="text-align: left;">2021-10-28</td>
<td style="text-align: left;">q</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">n</td>
<td style="text-align: left;">2021-10-23</td>
<td style="text-align: left;">i</td>
<td style="text-align: left;">a</td>
<td style="text-align: left;">2021-11-04</td>
<td style="text-align: left;">o</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: left;">r</td>
<td style="text-align: left;">2021-10-25</td>
<td style="text-align: left;">e</td>
<td style="text-align: left;">d</td>
<td style="text-align: left;">2021-11-18</td>
<td style="text-align: left;">d</td>
</tr>
</tbody>
</table>
</div>
</div>
</div></div>
</section><section id="toy-examples-left_join" class="slide level2 smaller center"><h2>Toy examples : <code>left_join</code>
</h2>
<div class="columns">
<div class="column" style="width:30%;">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<caption>R</caption>
<thead><tr class="header">
<th style="text-align: right;">A1</th>
<th style="text-align: left;">A2</th>
<th style="text-align: left;">A3</th>
<th style="text-align: left;">D</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">q</td>
<td style="text-align: left;">2021-10-21</td>
<td style="text-align: left;">r</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">e</td>
<td style="text-align: left;">2021-10-28</td>
<td style="text-align: left;">q</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: left;">a</td>
<td style="text-align: left;">2021-11-04</td>
<td style="text-align: left;">o</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: left;">j</td>
<td style="text-align: left;">2021-11-11</td>
<td style="text-align: left;">g</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: left;">d</td>
<td style="text-align: left;">2021-11-18</td>
<td style="text-align: left;">d</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top">
<caption>S</caption>
<thead><tr class="header">
<th style="text-align: right;">E</th>
<th style="text-align: left;">F</th>
<th style="text-align: left;">G</th>
<th style="text-align: left;">D</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">y</td>
<td style="text-align: left;">2021-10-21</td>
<td style="text-align: left;">o</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">e</td>
<td style="text-align: left;">2021-10-22</td>
<td style="text-align: left;">c</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: left;">n</td>
<td style="text-align: left;">2021-10-23</td>
<td style="text-align: left;">i</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: left;">t</td>
<td style="text-align: left;">2021-10-24</td>
<td style="text-align: left;">d</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: left;">r</td>
<td style="text-align: left;">2021-10-25</td>
<td style="text-align: left;">e</td>
</tr>
</tbody>
</table>
</div>
</div>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<caption>left_join(S, R, by=c(“E”=“A1”))</caption>
<thead><tr class="header">
<th style="text-align: right;">E</th>
<th style="text-align: left;">F</th>
<th style="text-align: left;">G</th>
<th style="text-align: left;">D.x</th>
<th style="text-align: left;">A2</th>
<th style="text-align: left;">A3</th>
<th style="text-align: left;">D.y</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">y</td>
<td style="text-align: left;">2021-10-21</td>
<td style="text-align: left;">o</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">e</td>
<td style="text-align: left;">2021-10-22</td>
<td style="text-align: left;">c</td>
<td style="text-align: left;">e</td>
<td style="text-align: left;">2021-10-28</td>
<td style="text-align: left;">q</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: left;">n</td>
<td style="text-align: left;">2021-10-23</td>
<td style="text-align: left;">i</td>
<td style="text-align: left;">a</td>
<td style="text-align: left;">2021-11-04</td>
<td style="text-align: left;">o</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: left;">t</td>
<td style="text-align: left;">2021-10-24</td>
<td style="text-align: left;">d</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
<td style="text-align: left;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: left;">r</td>
<td style="text-align: left;">2021-10-25</td>
<td style="text-align: left;">e</td>
<td style="text-align: left;">d</td>
<td style="text-align: left;">2021-11-18</td>
<td style="text-align: left;">d</td>
</tr>
</tbody>
</table>
</div>
</div>
</div></div>
</section><section id="toy-examples-semi_join-anti_join" class="slide level2 smaller center"><h2>Toy examples : <code>semi_join</code> <code>anti_join</code>
</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<caption>R</caption>
<thead><tr class="header">
<th style="text-align: right;">A1</th>
<th style="text-align: left;">A2</th>
<th style="text-align: left;">A3</th>
<th style="text-align: left;">D</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2</td>
<td style="text-align: left;">q</td>
<td style="text-align: left;">2021-10-21</td>
<td style="text-align: left;">r</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">e</td>
<td style="text-align: left;">2021-10-28</td>
<td style="text-align: left;">q</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: left;">a</td>
<td style="text-align: left;">2021-11-04</td>
<td style="text-align: left;">o</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: left;">j</td>
<td style="text-align: left;">2021-11-11</td>
<td style="text-align: left;">g</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: left;">d</td>
<td style="text-align: left;">2021-11-18</td>
<td style="text-align: left;">d</td>
</tr>
</tbody>
</table>
</div>
<div class="cell-output-display">
<table class="caption-top">
<caption>S</caption>
<thead><tr class="header">
<th style="text-align: right;">E</th>
<th style="text-align: left;">F</th>
<th style="text-align: left;">G</th>
<th style="text-align: left;">D</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">y</td>
<td style="text-align: left;">2021-10-21</td>
<td style="text-align: left;">o</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: left;">e</td>
<td style="text-align: left;">2021-10-22</td>
<td style="text-align: left;">c</td>
</tr>
<tr class="odd">
<td style="text-align: right;">6</td>
<td style="text-align: left;">n</td>
<td style="text-align: left;">2021-10-23</td>
<td style="text-align: left;">i</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: left;">t</td>
<td style="text-align: left;">2021-10-24</td>
<td style="text-align: left;">d</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: left;">r</td>
<td style="text-align: left;">2021-10-25</td>
<td style="text-align: left;">e</td>
</tr>
</tbody>
</table>
</div>
</div>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<caption>semi_join(S, R, by=c(“E”=“A1”))</caption>
<thead><tr class="header">
<th style="text-align: right;">E</th>
<th style="text-align: left;">F</th>
<th style="text-align: left;">G</th>
<th style="text-align: left;">D</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">4</td>
<td style="text-align: left;">e</td>
<td style="text-align: left;">2021-10-22</td>
<td style="text-align: left;">c</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: left;">n</td>
<td style="text-align: left;">2021-10-23</td>
<td style="text-align: left;">i</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10</td>
<td style="text-align: left;">r</td>
<td style="text-align: left;">2021-10-25</td>
<td style="text-align: left;">e</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br><br></p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top">
<caption>anti_join(S, R, by=c(“E”=“A1”))</caption>
<thead><tr class="header">
<th style="text-align: right;">E</th>
<th style="text-align: left;">F</th>
<th style="text-align: left;">G</th>
<th style="text-align: left;">D</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: left;">y</td>
<td style="text-align: left;">2021-10-21</td>
<td style="text-align: left;">o</td>
</tr>
<tr class="even">
<td style="text-align: right;">9</td>
<td style="text-align: left;">t</td>
<td style="text-align: left;">2021-10-24</td>
<td style="text-align: left;">d</td>
</tr>
</tbody>
</table>
</div>
</div>
</div></div>
</section><section id="conditional-theta--join" class="slide level2 center"><h2>Conditional/ <span class="math inline">\(\theta\)</span> -join</h2>
<p>In relational databases, joins are not restricted to <em>natural joins</em></p>
<div class="fragment">
<p><span class="math display">\[U \leftarrow R \bowtie_{\theta} S\]</span></p>
<p>reads as</p>
<p><span class="math display">\[\begin{array}{rl} T &amp; \leftarrow R \times S\\ U &amp; \leftarrow \sigma(T, \theta)\end{array}\]</span></p>
<p>where</p>
<ul>
<li><p><span class="math inline">\(R \times S\)</span> is the <em>cartesian product</em> of <span class="math inline">\(R\)</span> and <span class="math inline">\(S\)</span></p></li>
<li><p><span class="math inline">\(\theta\)</span> is a boolean expression that can be evaluated on any tuple of <span class="math inline">\(R \times S\)</span></p></li>
</ul>
</div>
</section><section id="do-we-need-conditional-theta--joins" class="slide level2 center"><h2>Do we need conditional/ <span class="math inline">\(\theta\)</span> -joins?</h2>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p><i class="fa-solid fa-hand-point-right" aria-label="hand-point-right"></i>: We can implement <span class="math inline">\(\theta\)</span>/conditional-joins by pipelining a cross product and a filtering</p>
</div>
</div>
</div>
<div class="fragment">
<div class="callout callout-caution callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Caution</strong></p>
</div>
<div class="callout-content">
<p><i class="fa-solid fa-skull-crossbones" aria-label="skull-crossbones"></i>: Cross products are costly:</p>
<ul>
<li><span class="math inline">\(\#\text{rows}(R \times S) = \#\text{rows}(R) \times \#\text{rows}(S)\)</span></li>
<li><span class="math inline">\(\#\text{cols}(R \times S) = \#\text{cols}(R) + \#\text{cols}(S)\)</span></li>
</ul>
</div>
</div>
</div>
</div>
</section><section id="do-we-need-conditional-theta--joins-1" class="slide level2 center"><h2>Do we need conditional/ <span class="math inline">\(\theta\)</span> -joins?</h2>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p><i class="fa-solid fa-database" aria-label="database"></i>: RDBMS use query planning and optimization, indexing to circumvent the cross product bottleneck (when possible)</p>
</div>
</div>
</div>
<div class="fragment">
<div class="callout callout-tip callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Tip</strong></p>
</div>
<div class="callout-content">
<p><i class="fa-brands fa-r-project" aria-label="r-project"></i>: if we need to perform a <span class="math inline">\(\theta\)</span>-join</p>
<ul>
<li>outsource it to a RDBMS, or</li>
<li>design an ad hoc pipeline</li>
</ul>
</div>
</div>
</div>

</div>
<aside><div>
<p><a href="https://www.r-bloggers.com/2018/02/in-between-a-rock-and-a-conditional-join/">About conditional join</a></p>
</div></aside></section><section id="a-conditional-join-between-flights-and-weather" class="slide level2 center"><h2>A conditional join between <code>flights</code> and <code>weather</code>
</h2>
<ul>
<li><p>The natural join between <code>flights</code> and <code>weather</code> we implemented can be regarded as an ad hoc conditional join between normalized versions of <code>weather</code> and <code>flights</code> <i class="fa-solid fa-lightbulb" aria-label="lightbulb"></i></p></li>
<li><p>Table <code>flights</code> and <code>weather</code> are redundant: <code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code> can be computed from <code>time_hour</code></p></li>
<li><p>Assume <code>flights</code> and <code>weather</code> are trimmed so as to become irredundant</p></li>
<li><p>The conditional join is then based on <em>truncations</em> of variables <code>time_hour</code></p></li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb47"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb47-1"><a></a><span class="kw">SELECT</span> </span>
<span id="cb47-2"><a></a>  <span class="op">*</span></span>
<span id="cb47-3"><a></a><span class="kw">FROM</span> </span>
<span id="cb47-4"><a></a>  flights <span class="kw">AS</span> f, weather <span class="kw">AS</span> w</span>
<span id="cb47-5"><a></a><span class="kw">WHERE</span> </span>
<span id="cb47-6"><a></a>  date_trunc(<span class="st">'hour'</span>, f.time_hour) <span class="op">=</span> date_trunc(<span class="st">'hour'</span>, w.time_hour)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ul>
<li>Adding redundant columns to <code>flights</code> and <code>weather</code> allows us to transform a tricky conditional join into a simple natural join <i class="fa-solid fa-champagne-glass" aria-label="champagne-glass"></i>
</li>
</ul>

<aside><div>
<p><a href="https://www.postgresql.org/docs/14/index.html">PostgreSQL documentation</a></p>
</div></aside></section></section><section><section id="creating-new-columns" class="title-slide slide level1 center" data-background-color="#1c191c"><h1>Creating new columns</h1>

</section><section id="section-8" class="slide level2 center"><h2></h2>
<p>Creation of new columns may happen</p>
<ul>
<li><p>on the fly</p></li>
<li><p>when altering (enriching) the schema of a table</p></li>
</ul>
<p>In databases, creation of new columns may be the result of a query or be the result of altering a table schema with <code>ALTER TABLE ADD COLUMN ...</code></p>
<p>In <code>tidyverse()</code> we use verbs <code>mutate</code> or <code>add_column</code> to add columns to the input table</p>
</section><section id="mutate" class="slide level2 center"><h2><code>mutate</code></h2>
<div class="columns">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb48"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a></a><span class="fu">mutate</span>(   <span class="co">#&lt;&lt;</span></span>
<span id="cb48-2"><a></a>  .data,</span>
<span id="cb48-3"><a></a>  <span class="at">new_col=</span> expression, <span class="co">#&lt;&lt;</span></span>
<span id="cb48-4"><a></a>  ...,   <span class="co">#&lt;&lt;</span></span>
<span id="cb48-5"><a></a>  <span class="at">.keep =</span> <span class="fu">c</span>(<span class="st">"all"</span>, <span class="st">"used"</span>, <span class="st">"unused"</span>, <span class="st">"none"</span>),</span>
<span id="cb48-6"><a></a>  <span class="at">.before =</span> <span class="cn">NULL</span>,</span>
<span id="cb48-7"><a></a>  <span class="at">.after =</span> <span class="cn">NULL</span></span>
<span id="cb48-8"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column">
<p><code>.data</code>: the input data frame</p>
<p><code>new_col= expression</code>:</p>
<ul>
<li><p><code>new_col</code> is the name of a new column</p></li>
<li><p><code>expression</code> is evaluated on each row of <code>.data</code> or it is a vector of length <code>1</code></p></li>
<li><p><code>all</code> is the default behavior, retains all columns from <code>.data</code></p></li>
</ul>
</div></div>
</section><section id="creating-a-categorical-column-to-spot-large-delays" class="slide level2 center"><h2>Creating a categorical column to spot large delays</h2>
<div class="cell columns column-output-location">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a></a>breaks_delay <span class="ot">&lt;-</span> <span class="fu">with</span>(flights,</span>
<span id="cb49-2"><a></a>  <span class="fu">c</span>(<span class="fu">min</span>(arr_delay, <span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb49-3"><a></a>    <span class="dv">0</span>, <span class="dv">30</span>,</span>
<span id="cb49-4"><a></a>    <span class="fu">max</span>(arr_delay, <span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb49-5"><a></a>)</span>
<span id="cb49-6"><a></a></span>
<span id="cb49-7"><a></a>level_delay <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"None"</span>,</span>
<span id="cb49-8"><a></a>                 <span class="st">"Moderate"</span>,</span>
<span id="cb49-9"><a></a>                 <span class="st">"Large"</span>)</span>
<span id="cb49-10"><a></a></span>
<span id="cb49-11"><a></a>flights <span class="sc">|&gt;</span></span>
<span id="cb49-12"><a></a>  <span class="fu">mutate</span>(<span class="at">large_delay =</span> <span class="fu">cut</span>(</span>
<span id="cb49-13"><a></a>    arr_delay,  <span class="co">#&lt;&lt;</span></span>
<span id="cb49-14"><a></a>    <span class="at">breaks=</span>breaks_delay, <span class="co">#&lt;&lt;</span></span>
<span id="cb49-15"><a></a>    <span class="at">labels=</span>level_delay,  <span class="co">#&lt;&lt;</span></span>
<span id="cb49-16"><a></a>    <span class="at">ordered_result=</span><span class="cn">TRUE</span>)) <span class="sc">|&gt;</span>   <span class="co">#&lt;&lt;</span></span>
<span id="cb49-17"><a></a>  <span class="fu">select</span>(large_delay, arr_delay) <span class="sc">|&gt;</span></span>
<span id="cb49-18"><a></a>  <span class="fu">sample_n</span>(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  large_delay arr_delay
  &lt;ord&gt;           &lt;dbl&gt;
1 Large             219
2 Moderate           18
3 None              -19
4 None              -16
5 None               -1</code></pre>
</div>
</div></div>
</section><section id="section-9" class="slide level2 center"><h2></h2>
<div class="cell columns column-output-location">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a></a>flights <span class="sc">|&gt;</span></span>
<span id="cb51-2"><a></a>  <span class="fu">mutate</span>(<span class="at">foo =</span> <span class="fu">if_else</span>(arr_time <span class="sc">&gt;</span> sched_arr_time,        <span class="co">#&lt;&lt;</span></span>
<span id="cb51-3"><a></a>                              arr_time <span class="sc">-</span> sched_arr_time,</span>
<span id="cb51-4"><a></a>                              <span class="dv">0</span>L,</span>
<span id="cb51-5"><a></a>                              <span class="at">missing =</span> <span class="cn">NA_integer_</span>)) <span class="sc">|&gt;</span></span>
<span id="cb51-6"><a></a>  <span class="fu">group_by</span>( (foo <span class="sc">&gt;</span><span class="dv">0</span>) <span class="sc">&amp;</span> <span class="fu">abs</span>(foo <span class="sc">-</span> arr_delay)  <span class="sc">&gt;</span> <span class="dv">100</span>) <span class="sc">|&gt;</span></span>
<span id="cb51-7"><a></a>  <span class="fu">summarise</span>(<span class="at">N=</span><span class="fu">n</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  `(foo &gt; 0) &amp; abs(foo - arr_delay) &gt; 100`      N
  &lt;lgl&gt;                                     &lt;int&gt;
1 FALSE                                    322281
2 TRUE                                       5157
3 NA                                         9338</code></pre>
</div>
</div></div>
</section><section id="changing-the-class-of-a-column" class="slide level2 center"><h2>Changing the class of a column</h2>
<div class="cell columns column-output-location">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a></a>flights <span class="sc">|&gt;</span></span>
<span id="cb53-2"><a></a>  <span class="fu">mutate</span>(<span class="at">large_delay =</span> <span class="fu">cut</span>(arr_delay,  <span class="co">#&lt;&lt;</span></span>
<span id="cb53-3"><a></a>    <span class="at">breaks=</span>breaks_delay,</span>
<span id="cb53-4"><a></a>    <span class="at">labels=</span>level_delay,</span>
<span id="cb53-5"><a></a>    <span class="at">ordered_result=</span><span class="cn">TRUE</span>),</span>
<span id="cb53-6"><a></a>    <span class="at">origin =</span> <span class="fu">as.factor</span>(origin), <span class="co">#&lt;&lt;</span></span>
<span id="cb53-7"><a></a>    <span class="at">dest =</span> <span class="fu">as.factor</span>(dest)    <span class="co">#&lt;&lt;</span></span>
<span id="cb53-8"><a></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb53-9"><a></a>  <span class="fu">select</span>(</span>
<span id="cb53-10"><a></a>    large_delay,</span>
<span id="cb53-11"><a></a>    arr_delay,</span>
<span id="cb53-12"><a></a>    origin,</span>
<span id="cb53-13"><a></a>    dest) <span class="sc">|&gt;</span></span>
<span id="cb53-14"><a></a>  <span class="fu">sample_n</span>(<span class="dv">5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  large_delay arr_delay origin dest 
  &lt;ord&gt;           &lt;dbl&gt; &lt;fct&gt;  &lt;fct&gt;
1 None              -44 LGA    CVG  
2 None              -15 EWR    DAY  
3 Large             136 EWR    DEN  
4 None               -9 EWR    TPA  
5 Moderate           14 LGA    TPA  </code></pre>
</div>
</div></div>
</section></section><section><section id="tidy-tables" class="title-slide slide level1 center" data-background-color="#1c191c"><h1>Tidy tables</h1>

</section><section id="tidying-tables-is-part-of-data-cleaning" class="slide level2 smaller center"><h2>Tidying tables is part of data cleaning</h2>
<blockquote>
<p>A (tidy) dataset is a collection of values, usually either numbers (if quantitative) or strings (if qualitative)</p>
</blockquote>
<blockquote>
<p>Values are organised in two ways</p>
</blockquote>
<blockquote>
<p>Every value belongs to a <em>variable</em> and an <em>observation</em></p>
</blockquote>
<blockquote>
<p>A <em>variable</em> contains all values that measure the same underlying attribute (like height, temperature, duration) across <em>units</em></p>
</blockquote>
<blockquote>
<p>An <em>observation</em> contains all values measured on the same <em>unit</em> (like a person, or a day, or a race) across attributes</p>
</blockquote>
<blockquote>
<p>The principles of tidy data are tied to those of relational databases and Codd’s relational algebra</p>
</blockquote>

<aside><div>
<p><a href="https://vita.had.co.nz/papers/tidy-data.html"><i class="fa-solid fa-book" aria-label="book"></i> The tidy data paper</a></p>
</div></aside></section><section id="codds-principles" class="slide level2 smaller center scrollable"><h2>Codd’s principles</h2>
<ol type="1">
<li>Information is represented logically in <em>tables</em>
</li>
<li>Data must be <em>logically accessible</em> by table, primary key, and column.</li>
<li>
<em>Null</em> values must be uniformly treated as “missing information,” not as empty strings, blanks, or zeros.</li>
<li>Metadata (data about the database) must be stored in the database just as regular data is</li>
<li>A single language must be able to define data, views, integrity constraints, <em>authorization</em>, <em>transactions</em>, and data manipulation</li>
<li>
<em>Views</em> must show the updates of their <em>base tables</em> and vice versa</li>
<li>A single operation must be available to do each of the following operations: retrieve data, insert data, update data, or delete data</li>
<li>Batch and end-user operations are <em>logically separate</em> from physical storage and access methods</li>
<li>Batch and end-user operations can change the database schema without having to recreate it or the applications built upon it</li>
<li>
<em>Integrity</em> constraints must be available and stored in the metadata, not in an application program</li>
<li>The data manipulation language of the relational system should not care where or how the physical data is distributed and should not require alteration if the physical data is centralized or distributed</li>
<li>Any <em>row processing</em> done in the system must obey the same <em>integrity rules</em> and <em>constraints</em> that set-processing operations do</li>
</ol></section><section id="section-10" class="slide level2 center"><h2><i class="fa-solid fa-bullhorn" aria-label="bullhorn"></i></h2>
<p><i class="fa-solid fa-hand-point-right" aria-label="hand-point-right"></i> <code>dplyr</code> functions expect and return <em>tidy</em> tables</p>
<p>In a <em>tidy</em> table</p>
<ul>
<li><p>Each variable is a column</p></li>
<li><p>Each observation is a row</p></li>
<li><p>Every cell is a single value</p></li>
</ul>

<aside><div>
<p><a href="https://vita.had.co.nz/papers/tidy-data.html"><i class="fa-solid fa-book" aria-label="book"></i> The tidy data paper</a>]</p>
</div></aside></section><section id="section-11" class="slide level2 center"><h2></h2>
<p><i class="fa-solid fa-hand-point-right" aria-label="hand-point-right"></i> In order to tell whether a table is tidy, we need to know what is the <em>population</em> under investigation, what are the observations/individuals, which measures are performed on each individual, …</p>
</section><section id="untidy-data" class="slide level2 center"><h2>Untidy data</h2>
<blockquote>
<p>Column headers are values, not variable names.</p>
</blockquote>
<blockquote>
<p>Multiple variables are stored in one column.</p>
</blockquote>
<blockquote>
<p>Variables are stored in both rows and columns.</p>
</blockquote>
<blockquote>
<p>Multiple types of observational units are stored in the same table.</p>
</blockquote>
<blockquote>
<p>A single observational unit is stored in multiple tables.</p>
</blockquote>
<blockquote>
<p>…</p>
</blockquote>
<p><i class="fa-solid fa-tools" aria-label="tools"></i></p>
</section><section id="functions-from-tidyr..." class="slide level2 center"><h2>Functions from <code>tidyr::...</code>
</h2>
<ul>
<li><p><code>pivot_wider</code> and <code>pivot_longer</code></p></li>
<li><p><code>separate</code> and <code>unite</code></p></li>
<li><p>Handling missing values with <code>complete</code>, <code>fill</code>, …</p></li>
<li><p>…</p></li>
</ul>
<p><a href="https://tidyr.tidyverse.org"><code>tidyr</code> website</a></p>
</section><section id="pivot-longer" class="slide level2 smaller center"><h2>Pivot longer</h2>
<div class="columns">
<div class="column" style="width:30%;">
<p><code>pivot_longer()</code> is commonly needed to tidy wild-caught datasets as they often optimise for ease of data entry or ease of comparison rather than ease of analysis.</p>
</div><div class="column" style="width:70%;">
<div class="cell columns column-output-location">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a></a>messy <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tribble</span>(</span>
<span id="cb55-2"><a></a>  <span class="sc">~</span>row, <span class="sc">~</span>a, <span class="sc">~</span>b, <span class="sc">~</span>c,</span>
<span id="cb55-3"><a></a>  <span class="st">"A"</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>,</span>
<span id="cb55-4"><a></a>  <span class="st">"B"</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>,</span>
<span id="cb55-5"><a></a>  <span class="st">"C"</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>,</span>
<span id="cb55-6"><a></a>)</span>
<span id="cb55-7"><a></a>messy <span class="sc">|&gt;</span> <span class="fu">kable</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column">
<div class="cell-output-display">
<table class="caption-top">
<thead><tr class="header">
<th style="text-align: left;">row</th>
<th style="text-align: right;">a</th>
<th style="text-align: right;">b</th>
<th style="text-align: right;">c</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">B</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">9</td>
</tr>
</tbody>
</table>
</div>
</div></div>
<div class="cell columns column-output-location">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a></a>messy_long <span class="ot">&lt;-</span> messy <span class="sc">|&gt;</span> </span>
<span id="cb56-2"><a></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb56-3"><a></a>    <span class="at">cols=</span><span class="fu">c</span>(<span class="sc">-</span>row),  <span class="co">#&lt;&lt;</span></span>
<span id="cb56-4"><a></a>    <span class="at">names_to =</span> <span class="st">"name"</span>,</span>
<span id="cb56-5"><a></a>    <span class="at">values_to =</span> <span class="st">"value"</span>)</span>
<span id="cb56-6"><a></a>  </span>
<span id="cb56-7"><a></a>messy_long  <span class="sc">|&gt;</span> </span>
<span id="cb56-8"><a></a>  <span class="fu">kable</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column">
<div class="cell-output-display">
<table class="caption-top">
<thead><tr class="header">
<th style="text-align: left;">row</th>
<th style="text-align: left;">name</th>
<th style="text-align: right;">value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A</td>
<td style="text-align: left;">a</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">A</td>
<td style="text-align: left;">b</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">A</td>
<td style="text-align: left;">c</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="even">
<td style="text-align: left;">B</td>
<td style="text-align: left;">a</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">B</td>
<td style="text-align: left;">b</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">B</td>
<td style="text-align: left;">c</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: left;">a</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">C</td>
<td style="text-align: left;">b</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: left;">c</td>
<td style="text-align: right;">9</td>
</tr>
</tbody>
</table>
</div>
</div></div>
</div></div>

<aside><div>
<blockquote>
<p><code>pivot_longer()</code> makes datasets longer by increasing the number of rows and decreasing the number of columns. I don’t believe it makes sense to describe a dataset as being in “long form”. Length is a relative term, and you can only say (e.g.) that dataset A is longer than dataset B.</p>
</blockquote>
</div></aside></section><section id="pivot-wider" class="slide level2 center"><h2>Pivot wider</h2>
<div class="columns">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb57"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a></a><span class="fu">pivot_wider</span>(  <span class="co">#&lt;&lt;</span></span>
<span id="cb57-2"><a></a>  data,</span>
<span id="cb57-3"><a></a>  <span class="at">id_cols =</span> <span class="cn">NULL</span>, <span class="co">#&lt;&lt;</span></span>
<span id="cb57-4"><a></a>  <span class="at">names_from =</span> name, <span class="co">#&lt;&lt;</span></span>
<span id="cb57-5"><a></a>  <span class="at">names_prefix =</span> <span class="st">""</span>,</span>
<span id="cb57-6"><a></a>  <span class="at">values_from =</span> value, <span class="co">#&lt;&lt;</span></span>
<span id="cb57-7"><a></a>  ...</span>
<span id="cb57-8"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><i class="fa-solid fa-hand-point-right" aria-label="hand-point-right"></i> some optional arguments are missing</p>
</div><div class="column">
<p>When reporting, we often use <code>pivot_wider</code> (explicitely or implicitely) to make results more readable, possibly to conform to a tradition</p>
<ul>
<li>Life tables in demography and actuarial science</li>
<li>Longitudinal data</li>
<li>See slide <a href="#/aggregate-pivot-wider">How many flights per day of week per departure airport?</a>
</li>
</ul>
</div></div>
</section><section id="pivot_wider-in-action" class="slide level2 center"><h2>
<code>pivot_wider()</code> in action</h2>
<div class="cell columns column-output-location">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a></a>messy_long <span class="sc">|&gt;</span></span>
<span id="cb58-2"><a></a>  <span class="fu">pivot_wider</span>( </span>
<span id="cb58-3"><a></a>  <span class="at">id_cols =</span> <span class="fu">c</span>(<span class="st">"row"</span>), <span class="co">#&lt;&lt;</span></span>
<span id="cb58-4"><a></a>  <span class="at">names_from =</span> name, <span class="co">#&lt;&lt;</span></span>
<span id="cb58-5"><a></a>  <span class="at">names_prefix =</span> <span class="st">""</span>,</span>
<span id="cb58-6"><a></a>  <span class="at">values_from =</span> value</span>
<span id="cb58-7"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  row       a     b     c
  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 A         1     4     7
2 B         2     5     8
3 C         3     6     9</code></pre>
</div>
</div></div>
</section></section><section><section id="aggregations" class="title-slide slide level1 center" data-background-color="#1c191c"><h1>Aggregations</h1>

</section><section id="how-many-flights-per-carrier" class="slide level2 center"><h2>How many flights per carrier?</h2>
<div class="cell columns column-output-location">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a></a>flights <span class="sc">|&gt;</span></span>
<span id="cb60-2"><a></a>  <span class="fu">group_by</span>(carrier) <span class="sc">|&gt;</span>  <span class="co">#&lt;&lt;</span></span>
<span id="cb60-3"><a></a>  <span class="fu">summarise</span>(<span class="at">count=</span><span class="fu">n</span>()) <span class="sc">|&gt;</span>  <span class="co">#&lt;&lt;</span></span>
<span id="cb60-4"><a></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(count))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 × 2
   carrier count
   &lt;chr&gt;   &lt;int&gt;
 1 UA      58665
 2 B6      54635
 3 EV      54173
 4 DL      48110
 5 AA      32729
 6 MQ      26397
 7 US      20536
 8 9E      18460
 9 WN      12275
10 VX       5162
11 FL       3260
12 AS        714
13 F9        685
14 YV        601
15 HA        342
16 OO         32</code></pre>
</div>
</div></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb62"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb62-1"><a></a><span class="kw">SELECT</span> </span>
<span id="cb62-2"><a></a>  carrier, <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="kw">AS</span> n</span>
<span id="cb62-3"><a></a><span class="kw">FROM</span> </span>
<span id="cb62-4"><a></a>  flights</span>
<span id="cb62-5"><a></a><span class="kw">GROUP</span> <span class="kw">BY</span> </span>
<span id="cb62-6"><a></a>  carrier</span>
<span id="cb62-7"><a></a><span class="kw">ORDER</span> <span class="kw">BY</span> </span>
<span id="cb62-8"><a></a>  n DESCENDING</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section><section id="how-many-flights-per-day-of-week-per-departure-airport" class="slide level2 smaller center"><h2>How many flights per day of week per departure airport?</h2>
<div class="cell columns column-output-location">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a></a>flights <span class="sc">|&gt;</span></span>
<span id="cb63-2"><a></a>  <span class="fu">group_by</span>(origin,  <span class="fu">wday</span>(time_hour, <span class="at">abbr=</span>T, <span class="at">label=</span>T)) <span class="sc">|&gt;</span>  <span class="co">#&lt;&lt;</span></span>
<span id="cb63-3"><a></a>  <span class="fu">summarise</span>(<span class="at">count=</span><span class="fu">n</span>(), <span class="at">.groups=</span><span class="st">"drop"</span>) <span class="sc">|&gt;</span>       <span class="co">#&lt;&lt;</span></span>
<span id="cb63-4"><a></a>  <span class="fu">rename</span>(<span class="at">day_of_week=</span><span class="st">`</span><span class="at">wday(time_hour, abbr = T, label = T)</span><span class="st">`</span>) <span class="sc">|&gt;</span></span>
<span id="cb63-5"><a></a>  <span class="fu">pivot_wider</span>(  <span class="co">#&lt;&lt;</span></span>
<span id="cb63-6"><a></a>    <span class="at">id_cols=</span><span class="st">"origin"</span>,   <span class="co">#&lt;&lt;</span></span>
<span id="cb63-7"><a></a>    <span class="at">names_from=</span><span class="st">"day_of_week"</span>, <span class="co">#&lt;&lt;</span></span>
<span id="cb63-8"><a></a>    <span class="at">values_from=</span><span class="st">"count"</span>) <span class="sc">|&gt;</span>  <span class="co">#&lt;&lt;</span></span>
<span id="cb63-9"><a></a>  <span class="fu">kable</span>(<span class="at">caption=</span><span class="st">"Departures per day"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column">
<div class="cell-output-display">
<table class="caption-top">
<caption>Departures per day</caption>
<thead><tr class="header">
<th style="text-align: left;">origin</th>
<th style="text-align: right;">dim.</th>
<th style="text-align: right;">lun.</th>
<th style="text-align: right;">mar.</th>
<th style="text-align: right;">mer.</th>
<th style="text-align: right;">jeu.</th>
<th style="text-align: right;">ven.</th>
<th style="text-align: right;">sam.</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">EWR</td>
<td style="text-align: right;">16425</td>
<td style="text-align: right;">18329</td>
<td style="text-align: right;">18243</td>
<td style="text-align: right;">18180</td>
<td style="text-align: right;">18169</td>
<td style="text-align: right;">18142</td>
<td style="text-align: right;">13347</td>
</tr>
<tr class="even">
<td style="text-align: left;">JFK</td>
<td style="text-align: right;">15966</td>
<td style="text-align: right;">16104</td>
<td style="text-align: right;">16017</td>
<td style="text-align: right;">15841</td>
<td style="text-align: right;">16087</td>
<td style="text-align: right;">16176</td>
<td style="text-align: right;">15088</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LGA</td>
<td style="text-align: right;">13966</td>
<td style="text-align: right;">16257</td>
<td style="text-align: right;">16162</td>
<td style="text-align: right;">16039</td>
<td style="text-align: right;">15963</td>
<td style="text-align: right;">15990</td>
<td style="text-align: right;">10285</td>
</tr>
</tbody>
</table>
</div>
</div></div>
</section></section><section><section id="window-queries" class="title-slide slide level1 center" data-background-color="#1c191c"><h1>Window queries</h1>

</section><section id="window-queries-1" class="slide level2 center"><h2>Window queries</h2>
<p>Assume we want to answer the question: for each day of week (Monday, Tuesday, …), what are the five carriers that experience the largest average delay?</p>
<div class="cell columns column-output-location">
<div class="column">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a></a>flights <span class="sc">|&gt;</span></span>
<span id="cb64-2"><a></a>  <span class="fu">group_by</span>(<span class="fu">weekdays</span>(time_hour), carrier) <span class="sc">|&gt;</span></span>
<span id="cb64-3"><a></a>  <span class="fu">summarise</span>(<span class="at">avg_dep_delay=</span><span class="fu">mean</span>(dep_delay, <span class="at">na.rm=</span>T)) <span class="sc">|&gt;</span></span>
<span id="cb64-4"><a></a>  <span class="fu">slice_max</span>(<span class="at">n=</span><span class="dv">2</span>, <span class="at">order_by=</span>avg_dep_delay)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div><div class="column">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 3
# Groups:   weekdays(time_hour) [7]
   `weekdays(time_hour)` carrier avg_dep_delay
   &lt;chr&gt;                 &lt;chr&gt;           &lt;dbl&gt;
 1 dimanche              F9               23.7
 2 dimanche              VX               17.4
 3 jeudi                 YV               29.7
 4 jeudi                 F9               26.5
 5 lundi                 FL               24.8
 6 lundi                 EV               23.4
 7 mardi                 YV               19.1
 8 mardi                 FL               17.7
 9 mercredi              OO               52  
10 mercredi              HA               24.5
11 samedi                OO               41  
12 samedi                F9               15.8
13 vendredi              OO               29  
14 vendredi              F9               25.6</code></pre>
</div>
</div></div>
</section><section id="the-sql-way" class="slide level2 smaller center"><h2>The SQL way</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb66"><pre class="sourceCode numberSource sql number-lines code-with-copy"><code class="sourceCode sql"><span id="cb66-1"><a></a><span class="kw">WITH</span> R <span class="kw">AS</span> (</span>
<span id="cb66-2"><a></a>  <span class="kw">SELECT</span> </span>
<span id="cb66-3"><a></a>    <span class="fu">EXTRACT</span>(dow <span class="kw">FROM</span> time_hour) <span class="kw">AS</span> day_of_week,</span>
<span id="cb66-4"><a></a>    carrier,</span>
<span id="cb66-5"><a></a>    <span class="fu">AVG</span>(dep_delay) <span class="kw">AS</span> avg_dep_delay</span>
<span id="cb66-6"><a></a>  <span class="kw">FROM</span> </span>
<span id="cb66-7"><a></a>    flights</span>
<span id="cb66-8"><a></a>  <span class="kw">GROUP</span> <span class="kw">BY</span> </span>
<span id="cb66-9"><a></a>    <span class="fu">EXTRACT</span>(dow <span class="kw">FROM</span> time_hour), carrier</span>
<span id="cb66-10"><a></a>), S <span class="kw">AS</span> (</span>
<span id="cb66-11"><a></a>  <span class="kw">SELECT</span> </span>
<span id="cb66-12"><a></a>    day_of_week,</span>
<span id="cb66-13"><a></a>    carrier,</span>
<span id="cb66-14"><a></a>    <span class="fu">rank</span>() <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">by</span> day_of_week <span class="kw">ORDER</span> <span class="kw">BY</span> avg_dep_delay <span class="kw">DESC</span>) <span class="kw">AS</span> rnk</span>
<span id="cb66-15"><a></a>  <span class="kw">FROM</span> </span>
<span id="cb66-16"><a></a>    R</span>
<span id="cb66-17"><a></a>)</span>
<span id="cb66-18"><a></a></span>
<span id="cb66-19"><a></a><span class="kw">SELECT</span> </span>
<span id="cb66-20"><a></a>  day_of_week, </span>
<span id="cb66-21"><a></a>  carrier, </span>
<span id="cb66-22"><a></a>  rnk</span>
<span id="cb66-23"><a></a><span class="kw">FROM</span> </span>
<span id="cb66-24"><a></a>  S</span>
<span id="cb66-25"><a></a><span class="kw">WHERE</span> </span>
<span id="cb66-26"><a></a>  rnk <span class="op">&lt;=</span> <span class="dv">10</span> ;</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section><section id="sliding-windows-and-package-slider" class="slide level2 center"><h2>Sliding windows and package <code>slider</code>
</h2>
<p>TODO</p>
</section></section><section><section id="pipelineschaining-operations" class="title-slide slide level1 center" data-background-color="#1c191c"><h1>Pipelines/chaining operations</h1>

</section><section id="and-other-pipes" class="slide level2 smaller center"><h2>
<code>|&gt;</code>, <code>%&gt;%</code> and other pipes</h2>
<ul>
<li><p>All <code>dplyr</code> functions take a table as the first argument</p></li>
<li><p>Rather than forcing the user to either save intermediate objects or nest functions, <code>dplyr</code> provides the <code>|&gt;</code> operator from <code>magrittr</code></p></li>
<li><p><code>x |&gt; f(y)</code> turns into <code>f(x, y)</code></p></li>
<li><p>The result from one step is <em>piped</em> into the next step</p></li>
<li><p>Use <code>|&gt;</code> to rewrite multiple operations that you can read left-to-right/top-to-bottom</p></li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a></a><span class="fu">g</span>(<span class="fu">f</span>(x, y), z)</span>
<span id="cb67-2"><a></a></span>
<span id="cb67-3"><a></a>x <span class="sc">|&gt;</span></span>
<span id="cb67-4"><a></a>  <span class="fu">f</span>(y) <span class="sc">|&gt;</span></span>
<span id="cb67-5"><a></a>  <span class="fu">g</span>(z)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>

<aside><div>
<p>From <a href="https://dplyr.tidyverse.org/articles/dplyr.html">dplyr vignette</a></p>
</div></aside></section><section id="magrittr" class="slide level2 center"><h2>Magrittr <code>%&gt;%</code>
</h2>
<div class="columns">
<div class="column">
<ul>
<li>
<code>%&gt;%</code> is not tied to <code>dplyr</code>
</li>
<li>
<code>%&gt;%</code> can be used with packages from <code>tidyverse</code>
</li>
<li>
<code>%&gt;%</code> can be used outside <code>tidyverse</code> that is with functions which take a table (or something else) as a second, third or keyword argument</li>
</ul>
<p><i class="fa-solid fa-magic" aria-label="magic"></i> Use pronoun <code>.</code> to denote the LHS of the pipe expression</p>
</div><div class="column">
<p>Second argument of <code>g</code> has the same type as the result of <code>f</code></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a></a><span class="fu">g</span>(z, <span class="fu">f</span>(x, y))</span>
<span id="cb68-2"><a></a></span>
<span id="cb68-3"><a></a>x <span class="sc">%&gt;%</span></span>
<span id="cb68-4"><a></a>  <span class="fu">f</span>(y) <span class="sc">%&gt;%</span></span>
<span id="cb68-5"><a></a>  <span class="fu">g</span>(z, .)   <span class="co">#&lt;&lt;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p><code>x %&gt;% f(y)</code> is a shorthand for <code>x %&gt;% f(., y)</code></p>
</div></div>
</section><section id="standard-pipe-version-4." class="slide level2 center"><h2>Standard pipe <code>|&gt;</code> (version &gt; 4.)</h2>
<p>As of version 4.1 (2021), base <i class="fa-brands fa-r-project" aria-label="r-project"></i> offers a pipe operator denoted by <code>|&gt;</code></p>
<div class="columns">
<div class="column">
<p><code>x |&gt; f(y)</code> turns into <code>f(x, y)</code></p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a></a><span class="fu">g</span>(<span class="fu">f</span>(x, y), z)</span>
<span id="cb69-2"><a></a></span>
<span id="cb69-3"><a></a>x <span class="sc">|&gt;</span></span>
<span id="cb69-4"><a></a>  <span class="fu">f</span>(y) <span class="sc">|&gt;</span></span>
<span id="cb69-5"><a></a>  <span class="fu">g</span>(z)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div><div class="column">
<p><i class="fa-solid fa-hand-point-right" aria-label="hand-point-right"></i> the standard pipe <code>|&gt;</code> has no pronoun/placeholder to denote the LHS of the pipe expression</p>
<p>The roundabout consists in using another new construct <code>\(x)</code></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb70"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a></a><span class="fu">g</span>(z, w)</span>
<span id="cb70-2"><a></a></span>
<span id="cb70-3"><a></a>x <span class="sc">|&gt;</span></span>
<span id="cb70-4"><a></a>  (\(x) <span class="fu">g</span>(z, <span class="at">w=</span>x))()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a></a><span class="st">"une"</span> <span class="sc">|&gt;</span></span>
<span id="cb71-2"><a></a>  (\(x) <span class="fu">str_c</span>(<span class="st">"ceci n'est pas"</span>, x, <span class="at">sep=</span><span class="st">" "</span>))() <span class="sc">|&gt;</span></span>
<span id="cb71-3"><a></a>  <span class="fu">str_c</span>(<span class="st">"pipe"</span>, <span class="at">sep=</span><span class="st">" "</span>) <span class="sc">|&gt;</span></span>
<span id="cb71-4"><a></a>  <span class="fu">cat</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>ceci n'est pas une pipe</code></pre>
</div>
</div>
</div></div>

<aside><div>
<p>See <a href="https://www.r-bloggers.com/2021/05/the-new-r-pipe/">Blog on the new standard pipe</a>]</p>
</div></aside></section><section id="other-pipes" class="slide level2 center"><h2>Other pipes</h2>
<p><code>Magrittr</code> offers several variants of <code>|&gt;</code></p>
<ul>
<li>Tee operator <code>%T&gt;%</code>
</li>
<li>Assignement pipe <code>%&lt;&gt;%</code>
</li>
<li>Exposition operator <code>%$%</code>
</li>
<li>…</li>
</ul>
<p>See <a href="https://www.r-bloggers.com/2017/12/pipes-in-r-tutorial-for-beginners/">pipes for beginners</a></p>
<p><i class="fa-solid fa-exclamation-triangle" aria-label="exclamation-triangle"></i> Base <i class="fa-brands fa-r-project" aria-label="r-project"></i> has a <code><a href="https://rdrr.io/r/base/connections.html">pipe()</a></code> function to manipulate connections (Files, URLs, …)</p>
</section><section id="references" class="slide level2 center"><h2>
<i class="fa-solid fa-book-reader" aria-label="book-reader"></i> References</h2>
<ul>
<li>
<a href="https://r4ds.had.co.nz">R for Data Science</a>
<ul>
<li><a href="https://r4ds.had.co.nz/transform.html">Data transformation</a></li>
</ul>
</li>
<li>Rstudio cheat sheets
<ul>
<li><a href="https://www.rstudio.com/resources/cheatsheets/">dplyr</a></li>
<li><a href="https://www.rstudio.com/resources/cheatsheets/">tidyr</a></li>
<li><a href="https://www.rstudio.com/resources/cheatsheets/">datatable</a></li>
<li><a href="https://www.rstudio.com/resources/cheatsheets/">readr</a></li>
</ul>
</li>
</ul></section></section><section><section id="pandas-python-versus-r-dataframes-in-words" class="title-slide slide level1 center" data-background-color="#1c191c"><h1>Pandas (Python) versus <code>R</code> dataframes : in words</h1>

</section><section id="section-12" class="slide level2 center"><h2></h2>
<p>The document <a href="https://pandas.pydata.org/docs/getting_started/comparison/comparison_with_r.html">Comparison with R in Pandas documentation</a> is somewhat outdated, yet, it remains useful.</p>
<p>In a single package, through classes <code>DataFrame</code> and <code>Series</code>, Pandas covers things that are handled by a collection of packages in <code>R</code> :</p>
<ul>
<li>Querying (<code>dplyr</code>, <code>dtplyr</code>, <code>dbplyr</code>)</li>
<li>Reshaping (<code>tidyr</code>)</li>
<li>Summary statistics (<code>skimr</code>)</li>
<li>Bridging with graphical backends (<code>ggplot2</code>)</li>
<li>Table display (<code>gt</code>)</li>
<li>Readers and writers (<code>readr</code>, <code>readxl</code>, …)</li>
<li>…</li>
</ul></section><section id="tidy-selection-and-tidy-evaluation" class="slide level2 center"><h2>Tidy selection and tidy evaluation</h2>
<p>Thanks to <em>tidy evaluation</em>, <code>R</code> programmers can avoid quoting column names. Some programmers like it that way.</p>
</section><section id="near-future" class="slide level2 center"><h2>Near future</h2>
<p>Pandas (up to 2.xx) has not been praised for its treatment of strings and missing data. This is changing with the <a href="https://pandas.pydata.org/docs/user_guide/pyarrow.html">Arrow revolution</a> and <a href="https://pandas.pydata.org/docs/user_guide/migration-3-strings.html">Pandas 3.0</a></p>
</section></section><section id="the-end" class="title-slide slide level1 center" data-background-color="#1c191c"><h1>The End</h1>


<div class="reveal-header">
<div class="header-logo" data-header-logo-link="https://u-paris.fr">
<img data-src="../../images/logo.png">
</div>
<div class="sc-title">
<p> </p>
</div>
<div class="header-text">
<p>Table calculus with dplyr</p>
</div>
<div class="sb-title">
<p> </p>
</div>
</div>
</section>
</div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="../../images/UniversiteParis_monogramme_couleur_RVB.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="http://s-v-b.github.io/MA7BY020">MA7BY020</a> – Analyse de Données – M1 MIDS – UParis Cité</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="../../site_libs/revealjs/dist/reveal.js"></script><!-- reveal.js plugins --><script src="../../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script><script src="../../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script><script src="../../site_libs/revealjs/plugin/reveal-menu/menu.js"></script><script src="../../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script><script src="../../site_libs/revealjs/plugin/quarto-support/support.js"></script><script src="../../site_libs/revealjs/plugin/notes/notes.js"></script><script src="../../site_libs/revealjs/plugin/search/search.js"></script><script src="../../site_libs/revealjs/plugin/zoom/zoom.js"></script><script src="../../site_libs/revealjs/plugin/math/math.js"></script><script>window.define = window.backupDefine; window.backupDefine = undefined;</script><script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: true,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: true,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script><script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script><script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/s-v-b\.github\.io\/MA7BY020\/");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
                // target, if specified
                link.setAttribute("target", "_blank");
                if (link.getAttribute("rel") === null) {
                  link.setAttribute("rel", "noopener");
                }
                // default icon
                link.classList.add("external");
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
            let selectedAnnoteEl;
            const selectorForAnnotation = ( cell, annotation) => {
              let cellAttr = 'data-code-cell="' + cell + '"';
              let lineAttr = 'data-code-annotation="' +  annotation + '"';
              const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
              return selector;
            }
            const selectCodeLines = (annoteEl) => {
              const doc = window.document;
              const targetCell = annoteEl.getAttribute("data-target-cell");
              const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
              const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
              const lines = annoteSpan.getAttribute("data-code-lines").split(",");
              const lineIds = lines.map((line) => {
                return targetCell + "-" + line;
              })
              let top = null;
              let height = null;
              let parent = null;
              if (lineIds.length > 0) {
                  //compute the position of the single el (top and bottom and make a div)
                  const el = window.document.getElementById(lineIds[0]);
                  top = el.offsetTop;
                  height = el.offsetHeight;
                  parent = el.parentElement.parentElement;
                if (lineIds.length > 1) {
                  const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
                  const bottom = lastEl.offsetTop + lastEl.offsetHeight;
                  height = bottom - top;
                }
                if (top !== null && height !== null && parent !== null) {
                  // cook up a div (if necessary) and position it 
                  let div = window.document.getElementById("code-annotation-line-highlight");
                  if (div === null) {
                    div = window.document.createElement("div");
                    div.setAttribute("id", "code-annotation-line-highlight");
                    div.style.position = 'absolute';
                    parent.appendChild(div);
                  }
                  div.style.top = top - 2 + "px";
                  div.style.height = height + 4 + "px";
                  div.style.left = 0;
                  let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
                  if (gutterDiv === null) {
                    gutterDiv = window.document.createElement("div");
                    gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                    gutterDiv.style.position = 'absolute';
                    const codeCell = window.document.getElementById(targetCell);
                    const gutter = codeCell.querySelector('.code-annotation-gutter');
                    gutter.appendChild(gutterDiv);
                  }
                  gutterDiv.style.top = top - 2 + "px";
                  gutterDiv.style.height = height + 4 + "px";
                }
                selectedAnnoteEl = annoteEl;
              }
            };
            const unselectCodeLines = () => {
              const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
              elementsIds.forEach((elId) => {
                const div = window.document.getElementById(elId);
                if (div) {
                  div.remove();
                }
              });
              selectedAnnoteEl = undefined;
            };
              // Handle positioning of the toggle
          window.addEventListener(
            "resize",
            throttle(() => {
              elRect = undefined;
              if (selectedAnnoteEl) {
                selectCodeLines(selectedAnnoteEl);
              }
            }, 10)
          );
          function throttle(fn, ms) {
          let throttle = false;
          let timer;
            return (...args) => {
              if(!throttle) { // first call gets through
                  fn.apply(this, args);
                  throttle = true;
              } else { // all the others get throttled
                  if(timer) clearTimeout(timer); // cancel #2
                  timer = setTimeout(() => {
                    fn.apply(this, args);
                    timer = throttle = false;
                  }, ms);
              }
            };
          }
            const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
            for (let i=0; i<annoteTargets.length; i++) {
              const annoteTarget = annoteTargets[i];
              const targetCell = annoteTarget.getAttribute("data-target-cell");
              const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
              const contentFn = () => {
                const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
                if (content) {
                  const tipContent = content.cloneNode(true);
                  tipContent.classList.add("code-annotation-tip-content");
                  return tipContent.outerHTML;
                }
              }
              const config = {
                allowHTML: true,
                content: contentFn,
                onShow: (instance) => {
                  selectCodeLines(instance.reference);
                  instance.reference.classList.add('code-annotation-active');
                  window.tippy.hideAll();
                },
                onHide: (instance) => {
                  unselectCodeLines();
                  instance.reference.classList.remove('code-annotation-active');
                },
                maxWidth: 300,
                delay: [50, 0],
                duration: [200, 0],
                offset: [5, 10],
                arrow: true,
                appendTo: function(el) {
                  return el.parentElement.parentElement.parentElement;
                },
                interactive: true,
                interactiveBorder: 10,
                theme: 'light-border',
                placement: 'right',
                popperOptions: {
                  modifiers: [
                  {
                    name: 'flip',
                    options: {
                      flipVariations: false, // true by default
                      allowedAutoPlacements: ['right'],
                      fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                    },
                  },
                  {
                    name: 'preventOverflow',
                    options: {
                      mainAxis: false,
                      altAxis: false
                    }
                  }
                  ]        
                }      
              };
              window.tippy(annoteTarget, config); 
            }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script><script type="text/javascript">
        (function(d) {
          d.querySelectorAll(".pseudocode-container").forEach(function(el) {
            let pseudocodeOptions = {
              indentSize: el.dataset.indentSize || "1.2em",
              commentDelimiter: el.dataset.commentDelimiter || "//",
              lineNumber: el.dataset.lineNumber === "true" ? true : false,
              lineNumberPunc: el.dataset.lineNumberPunc || ":",
              noEnd: el.dataset.noEnd === "true" ? true : false,
              titlePrefix: el.dataset.captionPrefix || "Algorithm"
            };
            pseudocode.renderElement(el.querySelector(".pseudocode"), pseudocodeOptions);
          });
        })(document);
        (function(d) {
          d.querySelectorAll(".pseudocode-container").forEach(function(el) {
            let captionSpan = el.querySelector(".ps-root > .ps-algorithm > .ps-line > .ps-keyword")
            if (captionSpan !== null) {
              let captionPrefix = el.dataset.captionPrefix + " ";
              let captionNumber = "";
              if (el.dataset.pseudocodeNumber) {
                captionNumber = el.dataset.pseudocodeNumber + " ";
                if (el.dataset.chapterLevel) {
                  captionNumber = el.dataset.chapterLevel + "." + captionNumber;
                }
              }
              captionSpan.innerHTML = captionPrefix + captionNumber;
            }
          });
        })(document);
        </script>


</body></html>